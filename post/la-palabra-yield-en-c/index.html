<!DOCTYPE html>
<html lang="es"  itemscope itemtype="http://schema.org/Blog">
<head>
        <!–– Made with Lockdown: https://github.com/fferegrino/lockdown ––>
  
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-translate-customization" content="108d9124921d80c3-80e20d618ff053c8-g4f02ec6f3dba68b7-c"></meta>

  <link rel="shortcut icon" href="">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-noto-sans@0.0.72/index.min.css">
  <link rel="stylesheet" href="/css/main.css">
  <script src="/js/main.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/vs.min.css" integrity="sha512-aWjgJTbdG4imzxTxistV5TVNffcYGtIQQm2NBNahV6LmX14Xq9WwZTL1wPjaSglUuVzYgwrq+0EuI4+vKvQHHw==" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js" integrity="sha512-9GIHU4rPKUMvNOHFOer5Zm2zHnZOjayOO3lZpokhhCtgt8FNlNiW/bb7kl0R5ZXfCDVPcQ8S4oBdNs92p5Nm2w==" crossorigin="anonymous"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script data-ad-client="ca-pub-9566151416325480" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#2176ff">
<meta name="msapplication-TileColor" content="#eeeef2">
<meta name="theme-color" content="#eeeef2">


<title>La palabra yield en C# | That C# guy</title>

<!-- Search Engine -->
<meta name="description" content="La palabra yield en C# tiene un uso bastante peculiar pero sencillo de entender cuando se explica de la manera adecuada, básicamente te ayudará a mejorar la eficiencia de tus aplicaciones. En este post trato de explicar qué es y cómo funciona eso a través de ejemplos de código.">
<meta name="image" content="">
<!-- Schema.org for Google -->
<meta itemprop="name" content="La palabra yield en C#">
<meta itemprop="description" content="La palabra yield en C# tiene un uso bastante peculiar pero sencillo de entender cuando se explica de la manera adecuada, básicamente te ayudará a mejorar la eficiencia de tus aplicaciones. En este post trato de explicar qué es y cómo funciona eso a través de ejemplos de código.">
<meta itemprop="image" content="">
<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="La palabra yield en C#">
<meta name="twitter:description" content="La palabra yield en C# tiene un uso bastante peculiar pero sencillo de entender cuando se explica de la manera adecuada, básicamente te ayudará a mejorar la eficiencia de tus aplicaciones. En este post trato de explicar qué es y cómo funciona eso a través de ejemplos de código.">
<meta name="twitter:site" content="@io_exception">
<meta name="twitter:creator" content="@io_exception">
<meta name="twitter:image" content="">
<!-- Open Graph general (Facebook, Pinterest & Google+) -->
<meta name="og:title" content="La palabra yield en C#">
<meta name="og:description" content="La palabra yield en C# tiene un uso bastante peculiar pero sencillo de entender cuando se explica de la manera adecuada, básicamente te ayudará a mejorar la eficiencia de tus aplicaciones. En este post trato de explicar qué es y cómo funciona eso a través de ejemplos de código.">
<meta name="og:image" content="">
<meta name="og:url" content="https://thatcsharpguy.com/">
<meta name="og:site_name" content="That C# guy">
<meta name="og:locale" content="es">
<meta name="og:type" content="website">


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GPXCSH21CP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-GPXCSH21CP');
</script>

        
</head>

<body style="position: relative; min-height: 100%; top: 0px;">  
        <header class="site-header " role="banner">
  <div class="wrapper">
     <div class="site-header-inner">
       <span class="site-brand">
         <a class="site-brand-inner" rel="author" href="/">
          <!-- <img class="site-favicon" title="Your awesome title" src="" onerror="this.style.display='none'"> -->
          That C# guy
        </a>
      </span>
        <nav class="site-nav">
           <input type="checkbox" id="nav-trigger" class="nav-trigger">
           <label for="nav-trigger">
              <span class="menu-icon">
                 <svg viewbox="0 0 18 15" width="18px" height="15px">
                    <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
                 </svg>
              </span>
           </label>
           <div class="trigger">
             <!-- Header links -->
              <a class="page-link" target="_blank" href="https://www.youtube.com/thatcsharpguy/">YOUTUBE</a>
              <span class="page-link">
    <div id="google_translate_element" style="display: none;"></div>
    <span class="ct-language">
       <ul class="list-unstyled ct-language-dropdown">
         <li>
            <a href="#" class="lang-select" data-lang="es">
            <img src="https://www.countryflags.io/mx/flat/64.png" title="México">
            </a>
         </li>
          <li>
             <a href="#" class="lang-select" data-lang="en">
             <img src="https://www.countryflags.io/gb/flat/64.png" title="English">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="fr">
             <img src="https://www.countryflags.io/fr/flat/64.png" title="Franch">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="zh-CN">
             <img src="https://www.countryflags.io/cn/flat/64.png" title="Chinese(Simple)">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="ja">
             <img src="https://www.countryflags.io/jp/flat/64.png" title="Japan">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="ko">
             <img src="https://www.countryflags.io/kr/flat/64.png" title="Korean">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="ru">
             <img src="https://www.countryflags.io/ru/flat/64.png" title="Russia">
             </a>
          </li>
       </ul>
    </span>
    <script type="text/javascript">
       function googleTranslateElementInit() {
         new google.translate.TranslateElement({
           pageLanguage: '',
           autoDisplay: false,
           layout: google.translate.TranslateElement.InlineLayout.VERTICAL
         }, 'google_translate_element');
       
         function restoreLang() {
           var iframe = document.getElementsByClassName('goog-te-banner-frame')[0];
           if (!iframe) return;
       
           var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
           var restore_el = innerDoc.getElementsByTagName("button");
       
           for (var i = 0; i < restore_el.length; i++) {
             if (restore_el[i].id.indexOf("restore") >= 0) {
               restore_el[i].click();
               var close_el = innerDoc.getElementsByClassName("goog-close-link");
               close_el[0].click();
               return;
             }
           }
         }
       
         function triggerHtmlEvent(element, eventName) {
           var event;
           if (document.createEvent) {
             event = document.createEvent('HTMLEvents');
             event.initEvent(eventName, true, true);
             element.dispatchEvent(event);
           } else {
             event = document.createEventObject();
             event.eventType = eventName;
             element.fireEvent('on' + event.eventType, event);
           }
         }
       
         var googleCombo = document.querySelector("select.goog-te-combo");
         var langSelect = document.querySelector('.ct-language');
         langSelect.addEventListener('click', function(event) {
           if (!event.target) {
             return;
           }
       
           var selected = document.querySelector('.ct-language .ct-language-selected');
           if (selected) {
             selected.classList.remove('ct-language-selected');
           }
       
           var target = event.target;
           while (target && target !== langSelect ) {
             if (target.matches('.lang-select')) {
               break;
             }
             target = target.parentElement;
           }
       
           if (target && target.matches('.lang-select')) {
             var lang = target.getAttribute('data-lang');
             if (lang == "es") {
               restoreLang();
             } else {
               target.parentElement.classList.add('ct-language-selected');
               googleCombo.value = lang;
               triggerHtmlEvent(googleCombo, 'change');
             }
           }
       
           event.preventDefault();
         });
       }
    </script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
 </span>
           </div>
        </nav>
     </div>
  </div>
</header>
<script>
  (function() {
    var lastScrollY = getScrollPos().y;
    var documentElement = document.documentElement;

    function storeScrollData() {
      var y = getScrollPos().y;

      documentElement.setAttribute("data-header-transparent", "");

      var scrollStatus = "";
      if (y <= 0) {
        scrollStatus = "top";
      } else if ((window.innerHeight + y) >= document.body.offsetHeight) {
        scrollStatus = "bottom";
      } else {
        var isScrollDown = (y - lastScrollY > 0) ? true : false;
        scrollStatus = isScrollDown ? "down" : "up";
      }
      lastScrollY = y;
      documentElement.setAttribute("data-scroll-status", scrollStatus);
    }
    window.addEventListener('scroll', function(e) {
      storeScrollData();
    });
    storeScrollData();
  })();
</script>
          
        

        <div class="theme-toggle">
    <input type="checkbox" id="theme-switch">
    <label for="theme-switch">
      <div class="toggle"></div>
      <div class="names">
        <p class="light">Light</p>
        <p class="dark">Dark</p>
      </div>
    </label>
  </div>
  
  
  <script>
    (function() {
      var sw = document.getElementById('theme-switch');
      var html = document.getElementsByTagName('html')[0];
      var nightModeOption = ('auto' || 'auto').toLowerCase();
      var storage = nightModeOption === 'manual'
          ? localStorage
          : sessionStorage;
      var themeData = loadThemeData();
  
      function saveThemeData(data) {
        storage.setItem('theme', JSON.stringify(data));
      }
  
      function loadThemeData() {
        var data = storage.getItem('theme');
        try {
          data = JSON.parse(data ? data : '');
        } catch(e) {
          data = { nightShift: undefined, autoToggleAt: 0 };
          saveThemeData(data);
        }
        return data;
      }
  
      function handleThemeToggle(nightShift) {
        themeData.nightShift = nightShift;
        saveThemeData(themeData);
        html.dataset.theme = nightShift ? 'dark' : 'light';
        setTimeout(function() {
          sw.checked = nightShift ? true : false;
        }, 50);
      }
  
      function autoThemeToggle() {
        // Next time point of theme toggle
        var now = new Date();
        var toggleAt = new Date();
        var hours = now.getHours();
        var nightShift = hours >= 19 || hours <=7;
  
        if (nightShift) {
          if (hours > 7) {
            toggleAt.setDate(toggleAt.getDate() + 1);
          }
          toggleAt.setHours(7);
        } else {
          toggleAt.setHours(19);
        }
  
        toggleAt.setMinutes(0);
        toggleAt.setSeconds(0);
        toggleAt.setMilliseconds(0)
  
        var delay = toggleAt.getTime() - now.getTime();
  
        // auto toggle theme mode
        setTimeout(function() {
          handleThemeToggle(!nightShift);
        }, delay);
  
        return {
          nightShift: nightShift,
          toggleAt: toggleAt.getTime()
        };
      }
  
      // Listen the theme toggle event
      sw.addEventListener('change', function(event) {
        handleThemeToggle(event.target.checked);
      });
  
      if (nightModeOption == 'auto') {
        var data = autoThemeToggle();
  
        // Toggle theme by local setting
        if (data.toggleAt > themeData.autoToggleAt) {
          themeData.autoToggleAt = data.toggleAt;
          handleThemeToggle(data.nightShift);
        } else {
          handleThemeToggle(themeData.nightShift);
        }
      } else if (nightModeOption == 'manual') {
        handleThemeToggle(themeData.nightShift);
      } else {
        var nightShift = themeData.nightShift;
        if (nightShift === undefined) {
          nightShift = nightModeOption === 'on';
        }
        handleThemeToggle(nightShift);
      }
    })();
  </script>

        <div class="page-content">
            <div class="wrapper">
                <div class="framework">
                    <section class="main">
                
<h1>La palabra yield en C#</h1>

<p>## La interfaz IEnumerable
Que un objeto implemente la clase IEnumerable significa que las instancias de esta tienen contenido sobre el que se puede iterar o recorrer. Este recorrido es siempre hacia &quot;adelante&quot;. Dicho &quot;en código&quot;, la interfaz <code>IEnumerable</code> (genérica o no) nos indica que podemos usar un bloque <code>foreach</code> para recorrer el objeto que la implemente. Por ejemplo, la clase <code>List&lt;T&gt;</code>, <code>ObservableCollection&lt;T&gt;</code> y los arreglos implementan esta clase. Es importante mencionar esto, ya que el tema que se verá a continuación está totalmente ligado a esta interfaz.</p>
<p>En el siguiente post vamos a ver una serie de métodos que tienen como tipo de retorno la interfaz <code>IEnumerable</code>, que como ya sabes ahora, es un tipo de dato que se puede recorrer, o que se puede iterar sobre él, ya sea en un ciclo <code>foreach</code> o empleando Linq.</p>
<h2>¿Para qué sirve yield?</h2>
<p>Considero que la mejor manera de explicar el uso de esta palabra reservada es mediante un ejemplo, así que observa el siguiente código antes de nada.</p>
<div class="pure-g">
<div class="pure-u-1 pure-u-md-1-2">
```csharp  
IEnumerable<int> GetMultiplesOf(int n, 
                                int start, 
                                int end)
{
    List<int> multiples = new List<int>();
    for (int i = start; i < end; i++)
    {
        if (i % n == 0)
        {
            Console.WriteLine(
                $"{i} GetMultiplesOf");
            multiples.Add(i);
        }
    }
    return multiples;
}
```  
</div> 
<div class="pure-u-1 pure-u-md-1-2">
```csharp  
IEnumerable<int> YieldMultiplesOf(int n, 
                                  int start, 
                                  int end)
{  
<pre><code>for (int i = start; i &lt; end; i++)
{
    if (i % n == 0)
    {
        Console.WriteLine(
            $&quot;{i} YieldMultiplesOf&quot;);
        yield return i;
    }
}  
</code></pre>
<p>}</p>
<pre><code>&lt;/div&gt;
&lt;/div&gt; 

** Para que dentro de un método se pueda usar la palabra `yield`, este debe tener como tipo de retorno una de las dos variantes de `IEnumerable`.**  

A simple vista pareciera que hacen lo mismo: encontrar los números divisibles entre `n`. La diferencia entre ellos radica en que mientras que uno crea una secuencia intermedia y almacena todos los valores antes de devolverlos, el otro devuelve uno por uno a quién lo llamó.

Para que veas el funcionamiento, vamos a llamarlos dentro de un ciclo `foreach`:

&lt;div class=&quot;pure-g&quot;&gt;
&lt;div class=&quot;pure-u-1 pure-u-md-1-2&quot;&gt;
```csharp  
Console.WriteLine(&quot;Normal collection&quot;);
foreach (var m in GetMultiplesOf(2, 1, 10))
{
    Console.WriteLine($&quot;{m} es multiplo de 2&quot;);
}
</code></pre>
</div>
<div class="pure-u-1 pure-u-md-1-2">
```csharp  
Console.WriteLine("Yield collection");
foreach (var m in YieldMultiplesOf(2, 1, 10))
{
    Console.WriteLine($"{m} es multiplo de 2");
}
```  
</div> 
</div>
<p>El resultado de ejecutarlas es el siguiente:</p>
<div class="pure-g">
<div class="pure-u-1 pure-u-md-1-2">
<pre>
Normal collection
2 GetMultiplesOf
4 GetMultiplesOf
6 GetMultiplesOf
8 GetMultiplesOf
2 es multiplo de 2
4 es multiplo de 2
6 es multiplo de 2
8 es multiplo de 2
</pre>
</div>
<div class="pure-u-1 pure-u-md-1-2">
<pre>
Yield collection
2 YieldMultiplesOf
2 es multiplo de 2
4 YieldMultiplesOf
4 es multiplo de 2
6 YieldMultiplesOf
6 es multiplo de 2
8 YieldMultiplesOf
8 es multiplo de 2
</pre>
</div> 
</div>  
<p>Wow, wow, ¿viste lo que ocurrió? mientras que en el que no usa <code>yield</code> se calcularon todos los valores en una sola llamada y se almacenaron en una lista temporal, en el otro solamente se calculó uno por uno y solamente cuando fue requerido. Evitándonos así tener que crear colecciones auxiliares para almacenar los datos.</p>
<p>Para comprender un poco mejor el funcionamiento, mira estas imágenes:</p>
<div class="pure-g">
<div class="pure-u-1 pure-u-md-1-2">
<img src="https://thatcsharpguy.github.io/postimages/aprende-c-sharp/yield/get.png" title="Normal Enumerable" />
</div>
<div class="pure-u-1 pure-u-md-1-2">
<img src="https://thatcsharpguy.github.io/postimages/aprende-c-sharp/yield/yield.png" title="Yield Enumerable" />
</div>
</div>
<p>En resumidas palabras, <code>yield</code> nos ayuda a implementar una especie de <em>&quot;lazy loading&quot;</em> en nuestro código introduciendo saltos entre un método y quien lo llamó para evitar así desperdiciar memoria en colecciones intermedias. Eso sin mencionar que usando esta técnica también podemos asegurar que para una determinada operación sobre un <code>IEnumerable</code> siempre se ejecutará la menor cantidad de iteraciones posibles.</p>
<p>Mira el siguiente ejemplo, en donde se aplican algunas operaciones de Linq:</p>
<div class="pure-g">
<div class="pure-u-1 pure-u-md-1-2">
```csharp  
var get = GetMultiplesOf(2, 320, 335)
            .Skip(3)
            .First();
Console.WriteLine($"El 4to multiplo es {get}");
```  
</div>
<div class="pure-u-1 pure-u-md-1-2">
```csharp  
var yield = YieldMultiplesOf(2, 320, 335)
                .Skip(3)
                .First();
Console.WriteLine($"El 4to multiplo es {yield}");
```  
</div>
</div>
<p>Y su resultado es el siguiente. Debes notar que para el caso de la colección intermedia se calcularon todos los valores posibles, mientras que para cuando se usó <code>yield</code> solo se calcularon los valores necesaros:</p>
<div class="pure-g">
<div class="pure-u-1 pure-u-md-1-2">
<pre>
320 GetMultiplesOf
322 GetMultiplesOf
324 GetMultiplesOf
326 GetMultiplesOf
328 GetMultiplesOf
330 GetMultiplesOf
332 GetMultiplesOf
334 GetMultiplesOf
El 4to multiplo es 326
</pre>
</div>
<div class="pure-u-1 pure-u-md-1-2">
<pre>
320 YieldMultiplesOf
322 YieldMultiplesOf
324 YieldMultiplesOf
326 YieldMultiplesOf
El 4to multiplo es 326
</pre>
</div> 
</div>  
<h2>Multiples returns</h2>
<p>Al igual que cuando usamos <code>return</code>, un método puede contener varias instrucciones <code>yield return</code>. Por ejemplo, imagina un programa en donde tengas que calcular los factores primos de un número:</p>
<pre><code class="language-csharp">public static IEnumerable&lt;int&gt; PrimeFactors(int n)
{
    while (n % 2 == 0)
    {
        yield return 2;
        n = n / 2;
    }

    for (int i = 3; i &lt;= Math.Sqrt(n); i += 2)
    {
        while (n % i == 0)
        {
            yield return i;
            n = n / i;
        }
    }

    if (n &gt; 2)
        yield return n;
}
</code></pre>
<p><strong>Por otro lado, si en algun momento queremos terminar la ejecución de este método podemos usar la combinación de palabras <code>yield break</code> para hacerlo.</strong></p>
<p>Sin duda también nos ayuda a implementar la &quot;lazy evaluation&quot; y ejecutar el código solamente cuando lo necesitamos, con ella nos ahorramos el crear una colección intermedia entre la fuente que generará los resultados y el destino de estos.</p>
<h2>Funcionamiento interno</h2>
<p>La palabra <code>yield</code> opera insertando saltos entre el método llamado y el código que lo llama... como vimos en una imagen anterior. Pero para que esto funcione, se debe almacenar cierta información que le indique al método llamado  en qué estado se encontraba antes de volver a ser ejecutado. Es por eso que cuando usamos la palabra <code>yield</code> el compilador entra en acción para nosotros, crea una clase intermedia en donde se almacena la información del estado de la iteración siguiente, te recomiendo que visites este enlace si deseas saber más.</p>
<h2>Ejemplos de uso</h2>
<p>Los ejemplos mostrados en el código pueden parecer un poco absurdos (lo sé) pero por ejemplo, ¿qué sucedería si en lugar de buscar los factores primos de un número, tuviéramos que encontrar una persona en un repositorio de datos de 1,000,000 de registros? o, ¿qué ocurriría con la memoria de nuestra computadora si tuviéramos que trabajar con las líneas de un archivo de 1Gb?</p>



                    </section>
                    <section class="sidebar">
                    <div class="post-menu">
                        <div class="post-menu-title">Sígueme en</div>
                        <div class="common-list">
                            <ul>
                            
                                <li>
                                    <a href="https://github.com/fferegrino">
                                    GitHub<span> <i class="fa fa-github"></i> </span>
                                    </a>
                                </li>
                            
                                <li>
                                    <a href="https://twitter.com/io_exception">
                                    Twitter<span> <i class="fa fa-twitter"></i> </span>
                                    </a>
                                </li>
                            
                                <li>
                                    <a href="https://twitter.com/io_exception">
                                    YouTube<span> <i class="fa fa-youtube"></i> </span>
                                    </a>
                                </li>
                            
                                <li>
                                    <a href="https://tcsg.dev/discord">
                                    Discord<span> <i class="fa fa-discord"></i> </span>
                                    </a>
                                </li>
                            
                            </ul>
                        </div>
                    </div>
                    
                    
                    </section>
                </div>
            </div>
        </div>
        <footer class="site-footer h-card">
   <data class="u-url" href="/"></data>
 
   <div class="wrapper">
     <div class="site-footer-inner">
       <div> </div>
       <div>Powered by <a title="Lockdonw in a simple, blog-aware, static site generator." href="https://github.com/lockdownblog/lockdown">Lockdown</a> &amp; <a title="Yat, yetanother theme." href="https://github.com/jeffreytse/jekyll-theme-yat">Yat Theme</a>.</div>
       <!-- <div class="footer-col rss-subscribe">Subscribe <a href="/feed.xml">via RSS</a></div> -->
     </div>
   </div>
 </footer>
</body>
</html>
