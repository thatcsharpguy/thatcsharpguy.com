<!DOCTYPE html>
<html lang="es" itemscope itemtype="http://schema.org/Blog">
    <head>
        <!–– Made with Lockdown: https://github.com/fferegrino/lockdown ––>
  
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-translate-customization" content="108d9124921d80c3-80e20d618ff053c8-g4f02ec6f3dba68b7-c"></meta>

  <link rel="shortcut icon" href="">
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
  <script src="https://kit.fontawesome.com/0271495296.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-noto-sans@0.0.72/index.min.css">
  <link rel="stylesheet" href="/css/main.css">
  <script src="/js/main.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/vs.min.css" integrity="sha512-aWjgJTbdG4imzxTxistV5TVNffcYGtIQQm2NBNahV6LmX14Xq9WwZTL1wPjaSglUuVzYgwrq+0EuI4+vKvQHHw==" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js" integrity="sha512-9GIHU4rPKUMvNOHFOer5Zm2zHnZOjayOO3lZpokhhCtgt8FNlNiW/bb7kl0R5ZXfCDVPcQ8S4oBdNs92p5Nm2w==" crossorigin="anonymous"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script data-ad-client="ca-pub-9566151416325480" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#2176ff">
<meta name="msapplication-TileColor" content="#eeeef2">
<meta name="theme-color" content="#eeeef2">


  <title>AutoMapper | That C# guy</title>

  <!-- Search Engine -->
  <meta name="description" content="AutoMapper es un mapeador objeto-objeto que &quot;convierte&quot; un objeto de un tipo a otro, sin embargo lo que hace realmente útil a esta herramienta es que facilita la tarea mediante el uso de convenciones de código.">
  <meta name="image" content="">
  <!-- Schema.org for Google -->
  <meta itemprop="name" content="AutoMapper">
  <meta itemprop="description" content="AutoMapper es un mapeador objeto-objeto que &quot;convierte&quot; un objeto de un tipo a otro, sin embargo lo que hace realmente útil a esta herramienta es que facilita la tarea mediante el uso de convenciones de código.">
  <meta itemprop="image" content="">
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="AutoMapper">
  <meta name="twitter:description" content="AutoMapper es un mapeador objeto-objeto que &quot;convierte&quot; un objeto de un tipo a otro, sin embargo lo que hace realmente útil a esta herramienta es que facilita la tarea mediante el uso de convenciones de código.">
  <meta name="twitter:site" content="@io_exception">
  <meta name="twitter:creator" content="@io_exception">
  <meta name="twitter:image" content="">
  <!-- Open Graph general (Facebook, Pinterest & Google+) -->
  <meta name="og:title" content="AutoMapper">
  <meta name="og:description" content="AutoMapper es un mapeador objeto-objeto que &quot;convierte&quot; un objeto de un tipo a otro, sin embargo lo que hace realmente útil a esta herramienta es que facilita la tarea mediante el uso de convenciones de código.">
  <meta name="og:image" content="">
  <meta name="og:url" content="https://thatcsharpguy.com/">
  <meta name="og:site_name" content="That C# guy">
  <meta name="og:locale" content="es">
  <meta name="og:type" content="website">


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GPXCSH21CP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GPXCSH21CP');
</script>

        
    </head>
    <body style="position: relative; min-height: 100%; top: 0px;">
        <header class="site-header " role="banner">
  <div class="wrapper">
     <div class="site-header-inner">
       <span class="site-brand">
         <a class="site-brand-inner" rel="author" href="/">
          <!-- <img class="site-favicon" title="Your awesome title" src="" onerror="this.style.display='none'"> -->
          That C# guy
        </a>
      </span>
        <nav class="site-nav">
           <input type="checkbox" id="nav-trigger" class="nav-trigger">
           <label for="nav-trigger">
              <span class="menu-icon">
                 <svg viewbox="0 0 18 15" width="18px" height="15px">
                    <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
                 </svg>
              </span>
           </label>
           <div class="trigger">
             <!-- Header links -->
              <a class="page-link" target="_blank" href="https://www.youtube.com/thatcsharpguy/">YOUTUBE</a>
              <span class="page-link">
    <div id="google_translate_element" style="display: none;"></div>
    <span class="ct-language">
       <ul class="list-unstyled ct-language-dropdown">
         <li>
            <a href="#" class="lang-select" data-lang="es">
            <img src="https://www.countryflags.io/mx/flat/64.png" title="México">
            </a>
         </li>
          <li>
             <a href="#" class="lang-select" data-lang="en">
             <img src="https://www.countryflags.io/gb/flat/64.png" title="English">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="fr">
             <img src="https://www.countryflags.io/fr/flat/64.png" title="Franch">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="zh-CN">
             <img src="https://www.countryflags.io/cn/flat/64.png" title="Chinese(Simple)">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="ja">
             <img src="https://www.countryflags.io/jp/flat/64.png" title="Japan">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="ko">
             <img src="https://www.countryflags.io/kr/flat/64.png" title="Korean">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="ru">
             <img src="https://www.countryflags.io/ru/flat/64.png" title="Russia">
             </a>
          </li>
       </ul>
    </span>
    <script type="text/javascript">
       function googleTranslateElementInit() {
         new google.translate.TranslateElement({
           pageLanguage: '',
           autoDisplay: false,
           layout: google.translate.TranslateElement.InlineLayout.VERTICAL
         }, 'google_translate_element');
       
         function restoreLang() {
           var iframe = document.getElementsByClassName('goog-te-banner-frame')[0];
           if (!iframe) return;
       
           var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
           var restore_el = innerDoc.getElementsByTagName("button");
       
           for (var i = 0; i < restore_el.length; i++) {
             if (restore_el[i].id.indexOf("restore") >= 0) {
               restore_el[i].click();
               var close_el = innerDoc.getElementsByClassName("goog-close-link");
               close_el[0].click();
               return;
             }
           }
         }
       
         function triggerHtmlEvent(element, eventName) {
           var event;
           if (document.createEvent) {
             event = document.createEvent('HTMLEvents');
             event.initEvent(eventName, true, true);
             element.dispatchEvent(event);
           } else {
             event = document.createEventObject();
             event.eventType = eventName;
             element.fireEvent('on' + event.eventType, event);
           }
         }
       
         var googleCombo = document.querySelector("select.goog-te-combo");
         var langSelect = document.querySelector('.ct-language');
         langSelect.addEventListener('click', function(event) {
           if (!event.target) {
             return;
           }
       
           var selected = document.querySelector('.ct-language .ct-language-selected');
           if (selected) {
             selected.classList.remove('ct-language-selected');
           }
       
           var target = event.target;
           while (target && target !== langSelect ) {
             if (target.matches('.lang-select')) {
               break;
             }
             target = target.parentElement;
           }
       
           if (target && target.matches('.lang-select')) {
             var lang = target.getAttribute('data-lang');
             if (lang == "es") {
               restoreLang();
             } else {
               target.parentElement.classList.add('ct-language-selected');
               googleCombo.value = lang;
               triggerHtmlEvent(googleCombo, 'change');
             }
           }
       
           event.preventDefault();
         });
       }
    </script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
 </span>
           </div>
        </nav>
     </div>
  </div>
</header>
<script>
  (function() {
    var lastScrollY = getScrollPos().y;
    var documentElement = document.documentElement;

    function storeScrollData() {
      var y = getScrollPos().y;

      documentElement.setAttribute("data-header-transparent", "");

      var scrollStatus = "";
      if (y <= 0) {
        scrollStatus = "top";
      } else if ((window.innerHeight + y) >= document.body.offsetHeight) {
        scrollStatus = "bottom";
      } else {
        var isScrollDown = (y - lastScrollY > 0) ? true : false;
        scrollStatus = isScrollDown ? "down" : "up";
      }
      lastScrollY = y;
      documentElement.setAttribute("data-scroll-status", scrollStatus);
    }
    window.addEventListener('scroll', function(e) {
      storeScrollData();
    });
    storeScrollData();
  })();
</script>
        
        <div class="theme-toggle">
  <input type="checkbox" id="theme-switch"/>
  <label for="theme-switch">
      <div class="toggle"></div>
      <div class="names">
          <p class="light">Light</p>
          <p class="dark">Dark</p>
      </div>
  </label>
</div>
  


<script>
    (function() {
      var sw = document.getElementById('theme-switch');
      var html = document.getElementsByTagName('html')[0];
      var nightModeOption = ('auto' || 'auto').toLowerCase();
      var storage = nightModeOption === 'manual'
          ? localStorage
          : sessionStorage;
      var themeData = loadThemeData();
  
      function saveThemeData(data) {
        storage.setItem('theme', JSON.stringify(data));
      }
  
      function loadThemeData() {
        var data = storage.getItem('theme');
        try {
          data = JSON.parse(data ? data : '');
        } catch(e) {
          data = { nightShift: undefined, autoToggleAt: 0 };
          saveThemeData(data);
        }
        return data;
      }
  
      function handleThemeToggle(nightShift) {
        themeData.nightShift = nightShift;
        saveThemeData(themeData);
        html.dataset.theme = nightShift ? 'dark' : 'light';
        setTimeout(function() {
          sw.checked = nightShift ? true : false;
        }, 50);
      }
  
      function autoThemeToggle() {
        // Next time point of theme toggle
        var now = new Date();
        var toggleAt = new Date();
        var hours = now.getHours();
        var nightShift = hours >= 19 || hours <=7;
  
        if (nightShift) {
          if (hours > 7) {
            toggleAt.setDate(toggleAt.getDate() + 1);
          }
          toggleAt.setHours(7);
        } else {
          toggleAt.setHours(19);
        }
  
        toggleAt.setMinutes(0);
        toggleAt.setSeconds(0);
        toggleAt.setMilliseconds(0)
  
        var delay = toggleAt.getTime() - now.getTime();
  
        // auto toggle theme mode
        setTimeout(function() {
          handleThemeToggle(!nightShift);
        }, delay);
  
        return {
          nightShift: nightShift,
          toggleAt: toggleAt.getTime()
        };
      }
  
      // Listen the theme toggle event
      sw.addEventListener('change', function(event) {
        handleThemeToggle(event.target.checked);
      });
  
      if (nightModeOption == 'auto') {
        var data = autoThemeToggle();
  
        // Toggle theme by local setting
        if (data.toggleAt > themeData.autoToggleAt) {
          themeData.autoToggleAt = data.toggleAt;
          handleThemeToggle(data.nightShift);
        } else {
          handleThemeToggle(themeData.nightShift);
        }
      } else if (nightModeOption == 'manual') {
        handleThemeToggle(themeData.nightShift);
      } else {
        var nightShift = themeData.nightShift;
        if (nightShift === undefined) {
          nightShift = nightModeOption === 'on';
        }
        handleThemeToggle(nightShift);
      }
    })();
  </script>
        <div class="page-content">
            <div class="wrapper">
                <div class="framework">
                    <section class="main"> 
                        
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
    <div class="post-content e-content" itemprop="articleBody">
        <h1>AutoMapper</h1>
        
<p>Hay muchas razones por las que como desarrolladores nos podemos ver en la necesidad de transferir, o mapear, información de un objeto a otro. Una de estas razones es para evitar el <a href="https://en.wikipedia.org/wiki/Mass_assignment_vulnerability" target="_blank" rel="nofollow">Overposting</a>.</p>
<p>En general se emplea el mapeo en los límites entre componentes de un sistema, ya sea de la base de datos a la capa de lógica, de la lógica a la interfaz gràfica o de un servicio web de un tercero a nuestra app. El hecho de que existan los mapeos favorece la separación de responsabilidades en el código.</p>
<p>Por ejemplo, cuando estamos trabajando con servicios web y recibimos un objeto simple y lo queremos transformar en algo con lo que nuestra aplicaciòn pueda trabajar, otro ejemplo es cuando somos nosotros los que enviamos la información de nuestra aplicación a través de un servicio web, sin embargo no queremos que el receptor tenga acceso a toda la información que tenemos disponible.</p>
<h2 id="ejemplo-practico">Ejemplo práctico</h2>
<p>Supongamos que tenemos un servicio web que sirve para consultar información sobre libros, de nuestra base de datos recuperamos la información a través de las siguientes entidades:</p>
<div class="pure-g">
<div class="pure-u-1 pure-u-md-1-2">
```csharp  
public class BookEntity
{
    public int Id { get; set; }
    public string Title { get; set; }
    public string Subtitle { get; set; }
    public int Pages { get; set; }
    public int Edition { get; set; }
    public AuthorEntity Author { get; set; }
}
```  
</div>
<div class="pure-u-1 pure-u-md-1-2">
```csharp  
public class AuthorEntity
{
    public int Id { get; set; }
    public string Name { get; set; }
    public int Age { get; set; }
    public List<BookEntity> Books { get; set; }
<p>}</p>
<pre><code>&lt;/div&gt;  
&lt;/div&gt;

Responder a la petición de un usuario con dichas clases, representaría dar más información de la que se necesita, es por eso usaremos estas clases para responder a cada petición:

&lt;div class=&quot;pure-g&quot;&gt;
&lt;div class=&quot;pure-u-1 pure-u-md-1-2&quot;&gt;
```csharp  
public class BookModel
{
    public string FullTitle { get; set; }
    public int Pages { get; set; }
    public int Edition { get; set; }
    public string AuthorName { get; set; }
    public DateTime TimeSent { get; set; }
}
</code></pre>
</div>
<div class="pure-u-1 pure-u-md-1-2">
```csharp  
public class AuthorModel
{
    public string Name { get; set; }
    public int Age { get; set; }
    public int BooksCount { get; set; }
}
  
  
```  
</div>  
</div>
<p>Ahora bien, podríamos pensar en hacerlo manualmente:</p>
<pre><code class="language-csharp">var modeloAutor = new AuthorModel();
modeloAutor.Name = entidadAutor.Name;
modeloAutor.Age = entidadAutor.Age;
modeloAutor.BooksCount = entidadAutor.Books != null ? entidadAutor.Books.Count : 0;
</code></pre>
<p>Pero no es una tarea sencilla si nuestros objetos comienzan a crecer en tamaño o complejidad... y ni hablar de lo aburrido que puede llegar a ser escribir cada mapeo &quot;a mano&quot;.</p>
<h2 id="automapper">AutoMapper</h2>
<p>Es por eso que a <a href="https://github.com/jbogard" target="_blank" rel="nofollow">Jimmy Bogard</a> se le ocurrió la idea de crear AutoMapper, que es una pequeña librería que nos ayudará a automatizar esta tarea.</p>
<p>AutoMapper es un mapeador objeto-objeto que &quot;convierte&quot; un objeto de un tipo a otro, sin embargo lo que hace realmente útil a esta herramienta es que facilita la tarea mediante el uso de convenciones de código, que le ayudan a decidir qué propiedad de un tipo se mapea al otro.</p>
<h3 id="configuracion">Configuración</h3>
<p>Para comenzar a usar AutoMapper demebos configurarlo, para lo cual utilizaremos una instancia de la clase <code>MapperConfiguration</code>, a través del que configuraremos el mapeo:</p>
<pre><code class="language-csharp">var automappingConfiguration = new AutoMapper.MapperConfiguration(config =&gt;
{
    // Configurar mapeo
</code></pre>
<h4 id="convenciones">Convenciones</h4>
<p>A partir de aquí se tiene que configurar cada mapeo objeto-objeto individualmente, necesitaremos dos tipos de dato una <em>fuente</em> y un <em>destino</em>, utilizando la variable <code>config</code> y su método <code>CreateMap</code> es como se realiza la tarea. Por ejemplo, para configurar el mapeo de <code>AuthorEntity</code> (la fuente) a <code>AuthorModel</code> (el destino) basta con una sola línea:</p>
<pre><code class="language-csharp">config.CreateMap&lt;AuthorEntity, AuthorModel&gt;();
</code></pre>
<p>Esto se debe a que para este mapeo utiliza las convenciones definidas por AutoMapper:</p>
<ul>
<li>Ambos tienen <code>Nombre</code> del tipo <code>string</code></li>
<li>Ambos tienen <code>Age</code> del tipo <code>int</code></li>
<li>para <code>BooksCount</code> en el destino, AutoMapper busca una colección <code>Books</code>, y obtendrá el número de elementos que contiene.</li>
</ul>
<p>Esto hace que el mapeo sea automático entre las dos propiedades, estas convenciones están incluídas en la librería, sin embargo <a href="https://lostechies.com/joshuaflanagan/2010/03/19/teaching-automapper-about-our-conventions/" target="_blank" rel="nofollow">podemos definir las nuestras</a>.</p>
<h4 id="personalizado">Personalizado</h4>
<p>Si tenemos unpar de objetos que requieren de un mapeo más complejo, tenemos a nuestra disposición algunos métodos adicionales, que nos ayudarán a configurar a mayor profundidad AutoMapper, toma por ejemplo las dos entidades <code>BookEntity</code> (la fuente) a <code>BookModel</code> (el destino):</p>
<pre><code class="language-csharp">config.CreateMap&lt;BookEntity, BookModel&gt;()
    .ForMember(dest =&gt; dest.AuthorName, 
        opt =&gt; opt.ResolveUsing(entity =&gt; entity.Author.Name))
    .ForMember(dest =&gt; dest.FullTitle,
        opt =&gt; opt.ResolveUsing(entity =&gt; entity.Title + &quot; &quot; + entity.Subtitle))
    .ForMember(dest =&gt; dest.TimeSent, opt =&gt; opt.Ignore());
</code></pre>
<p>Veamos por partes lo que está sucediendo en el código anterior:</p>
<ol>
<li>Con <code>config.CreateMap&lt;BookEntity, BookModel&gt;()</code> estamos indicando el inicio de una configuración de mapeo.</li>
<li>Con el método <code>ForMember</code> le estamos indicando que la propiedad <code>AuthorName</code> en el destino la debe obtener de <code>Author.Name</code> en la fuente</li>
<li>Al igual que en la anterior, le estamos diciendo que <code>FullTitle</code> la obtenga de concatenar <code>Title</code>, un espacio en blanco y <code>Subtitle</code> de la fuente</li>
<li>El destino tiene una propiedad llamada <code>TimeSent</code> que no existe en la fuente, para asegurar que el mapeo sea correcto, le decimos a la configuración que la ignore mediante el método <code>Ignore</code>.</li>
</ol>
<p>Para este ejemplo no se requiere de una configuración más compleja, sin embargo si tu aplicación la requiere, puedes checar <a href="https://github.com/AutoMapper/AutoMapper/wiki/Custom-value-resolvers" target="_blank" rel="nofollow"><i>custom resolvers</i></a>, <a href="https://github.com/AutoMapper/AutoMapper/wiki/Custom-type-converters" target="_blank" rel="nofollow"><i>custom type converters</i></a>, <a href="https://github.com/AutoMapper/AutoMapper/wiki/Conditional-mapping" target="_blank" rel="nofollow">mapeo condicional</a> o cualquier otra de las posibilidades que puedes consultar en la <a href="https://github.com/AutoMapper/AutoMapper/wiki" target="_blank" rel="nofollow">documentación de AutoMapper</a>.</p>
<h3 id="uso">Uso</h3>
<p>Una vez que hemos <a href="#configuracion">configurado</a> el mapeo, debemos llamar al método <code>CreateMapper</code> de la clase <code>MapperConfiguration</code></p>
<pre><code class="language-csharp">var mapper = automappingConfiguration.CreateMapper();
</code></pre>
<p>la cual nos devolverá una instancia de un objeto que implementa <code>IMapper</code>, que es a través del cual se realizará cada mapeo. Luego, con esta instancia a nuestra disposición, bastará con llamar a <code>Map</code> pasándole una instancia de la fuente (desde la que queremos mapear) y el tipo del destino (al que queremos llegar):</p>
<pre><code class="language-csharp">// De AuthorEntity a AuthorModel
var modeloAutor = mapper.Map&lt;AuthorModel&gt;(entidadAutor);

// De BookEntity a BookModel
var modeloLibro = mapper.Map&lt;BookModel&gt;(bookEntity);
</code></pre>
<p>Como podrás ver, podemos centralizar bastante la tarea de mapeo, y es que en tu aplicación <strong>basta con tener una sola referencia a <code>IMapper</code></strong>, así que es lo normal que únicamente la asignes una vez y la reutilizes a través de una propiedad estática o un patrones de diseño de aplicaciones como DI o singleton.</p>
<h2 id="conclusion">Conclusión</h2>
<p>Este post apenas y roza la superficie de todo las posibilidades que AutoMapper tiene para nosotros y no cabe duda de que después de adentrarte en la documentación podrás encontrarle más utilidad. Además de que AutoMapper también es fácilmente integrable con patrones de diseño, incluyendo la Inyección de Dependencias. Si existe algo en lo que estés atorado con la configuración, tal vez pueda ayudar.</p>
<h1 id="instalacion">Instalación</h1>
<p>Para instalarlo no hay mejor manera que el gestor de paquetes de NuGet:</p>
<pre><code>PM&gt; Install-Package AutoMapper
</code></pre>
<p>O échale un ojo al <a href="https://github.com/AutoMapper/AutoMapper" target="_blank" rel="nofollow">proyecto en GitHub</a> y contribuir a su desarrollo de alguna manera.</p>


    </div>
</article>

                    </section>
                    <section class="sidebar">
                        <div class="theme-toggle">
  <input type="checkbox" id="theme-switch"/>
  <label for="theme-switch">
      <div class="toggle"></div>
      <div class="names">
          <p class="light">Light</p>
          <p class="dark">Dark</p>
      </div>
  </label>
</div>
  


<script>
    (function() {
      var sw = document.getElementById('theme-switch');
      var html = document.getElementsByTagName('html')[0];
      var nightModeOption = ('auto' || 'auto').toLowerCase();
      var storage = nightModeOption === 'manual'
          ? localStorage
          : sessionStorage;
      var themeData = loadThemeData();
  
      function saveThemeData(data) {
        storage.setItem('theme', JSON.stringify(data));
      }
  
      function loadThemeData() {
        var data = storage.getItem('theme');
        try {
          data = JSON.parse(data ? data : '');
        } catch(e) {
          data = { nightShift: undefined, autoToggleAt: 0 };
          saveThemeData(data);
        }
        return data;
      }
  
      function handleThemeToggle(nightShift) {
        themeData.nightShift = nightShift;
        saveThemeData(themeData);
        html.dataset.theme = nightShift ? 'dark' : 'light';
        setTimeout(function() {
          sw.checked = nightShift ? true : false;
        }, 50);
      }
  
      function autoThemeToggle() {
        // Next time point of theme toggle
        var now = new Date();
        var toggleAt = new Date();
        var hours = now.getHours();
        var nightShift = hours >= 19 || hours <=7;
  
        if (nightShift) {
          if (hours > 7) {
            toggleAt.setDate(toggleAt.getDate() + 1);
          }
          toggleAt.setHours(7);
        } else {
          toggleAt.setHours(19);
        }
  
        toggleAt.setMinutes(0);
        toggleAt.setSeconds(0);
        toggleAt.setMilliseconds(0)
  
        var delay = toggleAt.getTime() - now.getTime();
  
        // auto toggle theme mode
        setTimeout(function() {
          handleThemeToggle(!nightShift);
        }, delay);
  
        return {
          nightShift: nightShift,
          toggleAt: toggleAt.getTime()
        };
      }
  
      // Listen the theme toggle event
      sw.addEventListener('change', function(event) {
        handleThemeToggle(event.target.checked);
      });
  
      if (nightModeOption == 'auto') {
        var data = autoThemeToggle();
  
        // Toggle theme by local setting
        if (data.toggleAt > themeData.autoToggleAt) {
          themeData.autoToggleAt = data.toggleAt;
          handleThemeToggle(data.nightShift);
        } else {
          handleThemeToggle(themeData.nightShift);
        }
      } else if (nightModeOption == 'manual') {
        handleThemeToggle(themeData.nightShift);
      } else {
        var nightShift = themeData.nightShift;
        if (nightShift === undefined) {
          nightShift = nightModeOption === 'on';
        }
        handleThemeToggle(nightShift);
      }
    })();
  </script>
                        <div class="post-menu">
                            <div class="post-menu-title">Sígueme en</div>
                            <div class="common-list">
                                <ul>
                                    
                                    <li>
                                        <a href="https://github.com/fferegrino">GitHub<span><i class="fab fa-github"></i></span></a>
                                    </li>
                                    
                                    <li>
                                        <a href="https://twitter.com/io_exception">Twitter<span><i class="fab fa-twitter"></i></span></a>
                                    </li>
                                    
                                    <li>
                                        <a href="https://youtube.com/thatcsharpguy">YouTube<span><i class="fab fa-youtube"></i></span></a>
                                    </li>
                                    
                                    <li>
                                        <a href="https://tcsg.dev/discord">Discord<span><i class="fab fa-discord"></i></span></a>
                                    </li>
                                    
                                </ul>
                            </div>
                        </div>
                        
 <style type="text/css" media="screen">
    .post-menu ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
</style>
<div class="post-menu toc">
    <div class="post-menu-title">TOC</div>
    <div class="post-menu-content"></div>
</div>
<script>
    function generateContent() {
        var menu = document.querySelector(".post-menu.toc");
        console.log(menu);
        var menuContent = menu.querySelector(".post-menu-content");
        var headings = document.querySelector(".post-content").querySelectorAll("h2, h3, h4, h5, h6");
        // Hide menu when no headings
        if (headings.length === 0) {
            return menu.style.display = "none";
        }
        // Generate post menu
        var menuHTML = '';
        for (var i = 0; i < headings.length; i++) {
            var h = headings[i];
            menuHTML += ('<li class="h-' + h.tagName.toLowerCase() + '">' + '<a href="#' + h.getAttribute('id') + '">' + h.textContent + '</a></li>');
        }
        menuContent.innerHTML = '<ul>' + menuHTML + '</ul>';
        // The header element
        var header = document.querySelector('header.site-header');
        function doMenuCollapse(index, over_items) {
            var items = menuContent.firstChild.children;
            if (over_items == undefined) {
                over_items = 20;
            }
            if (items.length<over_items) {
        return;
      }

      var activeItem = items[index];
      var beginItem = activeItem
      var endItem = activeItem
      var beginIndex = index;
      var endIndex = index + 1;
      while (beginIndex >= 0 && ! items[beginIndex].classList.contains('h-h2')) {
                beginIndex -= 1;
            }
            while (endIndex < items.length && ! items[endIndex].classList.contains('h-h2')) {
                endIndex += 1;
            }
            for (var i = 0; i < beginIndex; i++) {
                item = items[i]
                if (!item.classList.contains('h-h2')) {
                    item.style.display = 'none';
                }
            }
            for (var i = beginIndex + 1; i < endIndex; i++) {
                item = items[i]
                // if (!item.classList.contains('h-h2')) {
                item.style.display = '';
                // }
            }
            for (var i = endIndex; i < items.length; i++) {
                item = items[i]
                if (!item.classList.contains('h-h2')) {
                    item.style.display = 'none';
                }
            }
        }
        // Init menu collapsed
        doMenuCollapse(-1);
        // Active the menu item
        window.addEventListener('scroll', function (event) {
            var lastActive = menuContent.querySelector('.active');
            var changed = true;
            var activeIndex = -1;
            for (var i = headings.length - 1; i >= 0; i--) {
                var h = headings[i];
                var headingRect = h.getBoundingClientRect();
                var headerRect = header.getBoundingClientRect();
                var headerTop = Math.floor(headerRect.top);
                var headerHeight = Math.floor(headerRect.height);
                var headerHeight = headerTop + headerHeight + 20;
                if (headingRect.top <= headerHeight) {
                    var id = 'h-' + h.getAttribute('id');
                    var a = menuContent.querySelector('a[href="#' + id + '"]');
                    var curActive = a.parentNode;
                    if (curActive) {
                        curActive.classList.add('active');
                        activeIndex = i;
                    }
                    if (lastActive == curActive) {
                        changed = false;
                    }
                    break;
                }
            }
            if (changed) {
                if (lastActive) {
                    lastActive.classList.remove('active');
                }
                doMenuCollapse(activeIndex);
            }
            event.preventDefault();
        });
    }
    document.addEventListener("DOMContentLoaded", function() {
        generateContent()
    });
</script>

                    </section>
                </div>
            </div>
        </div>
        <footer class="site-footer h-card">
   <data class="u-url" href="/"></data>
 
   <div class="wrapper">
     <div class="site-footer-inner">
       <div> </div>
       <div>Powered by <a title="Lockdonw in a simple, blog-aware, static site generator." href="https://github.com/lockdownblog/lockdown">Lockdown</a> &amp; <a title="Yat, yetanother theme." href="https://github.com/jeffreytse/jekyll-theme-yat">Yat Theme</a>.</div>
       <!-- <div class="footer-col rss-subscribe">Subscribe <a href="/feed.xml">via RSS</a></div> -->
     </div>
   </div>
 </footer>
    </body>
</html>