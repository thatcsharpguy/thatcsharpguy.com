<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-translate-customization" content="108d9124921d80c3-80e20d618ff053c8-g4f02ec6f3dba68b7-c"></meta>
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#2176ff">
<meta name="msapplication-TileColor" content="#00aba9">
<meta name="theme-color" content="#ffffff">
<title>Publicando aplicaciones hechas con Xamarin desde GitHub Actions | That C# guy</title>
<!-- Search Engine -->
<meta name="description" content="Aplica la integraci贸n continua a tus aplicaciones hechas con Xamarin y publica desde GitHub Actions.">
<meta name="image" content="https://i.imgur.com/zGD1Caj.png">
<!-- Schema.org for Google -->
<meta itemprop="name" content="Publicando aplicaciones hechas con Xamarin desde GitHub Actions">
<meta itemprop="description" content="Aplica la integraci贸n continua a tus aplicaciones hechas con Xamarin y publica desde GitHub Actions.">
<meta itemprop="image" content="https://i.imgur.com/zGD1Caj.png">
<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Publicando aplicaciones hechas con Xamarin desde GitHub Actions">
<meta name="twitter:description" content="Aplica la integraci贸n continua a tus aplicaciones hechas con Xamarin y publica desde GitHub Actions.">
<meta name="twitter:site" content="@thatcsharpguy">
<meta name="twitter:creator" content="@io_exception">
<meta name="twitter:image" content="https://i.imgur.com/zGD1Caj.png">
<!-- Open Graph general (Facebook, Pinterest & Google+) -->
<meta name="og:title" content="Publicando aplicaciones hechas con Xamarin desde GitHub Actions">
<meta name="og:description" content="Aplica la integraci贸n continua a tus aplicaciones hechas con Xamarin y publica desde GitHub Actions.">
<meta name="og:image" content="https://i.imgur.com/zGD1Caj.png">
<meta name="og:url" content="https://thatcsharpguy.com/post/publicando-aplicaciones-hechas-con-xamarin-desde-github-actions">
<meta name="og:site_name" content="That C# guy">
<meta name="og:locale" content="es">
<meta name="og:type" content="website">
  <script src="https://kit.fontawesome.com/0271495296.js" crossorigin="anonymous"></script>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,400;0,700;1,400;1,700&family=Open+Sans:ital,wght@0,300;0,400;0,600;0,800;1,400;1,800&display=swap" rel="stylesheet">
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-noto-sans@0.0.72/index.min.css"> -->
  <link rel="stylesheet" href="/css/main.css">
  <script src="/js/main.js"></script>
<link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
<!-- and it's easy to individually load additional languages -->
<script charset="UTF-8"
        src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/go.min.js"></script>

















<script>
// Init highlight js
document.addEventListener('DOMContentLoaded', function(event) {
  var els = document.querySelectorAll('pre code')

  function addLangData(block) {
    var outer = block.parentElement.parentElement.parentElement;
    var lang = block.getAttribute('data-lang');
    for (var i = 0; i < outer.classList.length; i++) {
      var cls = outer.classList[i];
      if (cls.startsWith('language-')) {
        lang = cls;
        break;
      }
    }
    if (!lang) {
      cls = block.getAttribute('class');
      lang = cls ? cls.replace('hljs ', '') : '';
    }
    if (lang.startsWith('language-')) {
      lang = lang.substr(9);
    }
    block.setAttribute('class', 'hljs ' + lang);
    block.parentNode.setAttribute('data-lang', lang);
  }

  function addBadge(block) {
    var enabled = ('' || 'true').toLowerCase();
    if (enabled == 'true') {
      var pre = block.parentElement;
      pre.classList.add('badge');
    }
  }

  function handle(block) {
    addLangData(block);
    addBadge(block)
    hljs.highlightBlock(block);
  }

  for (var i = 0; i < els.length; i++) {
    var el = els[i];
    handle(el);
  }
});
</script>

<style>
  /* code language badge */
  pre.badge::before {
    content: attr(data-lang);
    color: ;
    background-color: ;
    padding: 0 .5em;
    border-radius: 0 2px;
    text-transform: ;
    text-align: center;
    min-width: 32px;
    display: inline-block;
    position: absolute;
    right: 0;
  }

  /* fix wrong badge display for firefox browser */
  code > table pre::before {
    display: none;
  }
</style>
</head>


  <body>


<header class="site-header " role="banner">

  <div class="wrapper">
    <div class="site-header-inner">

      <span class="site-brand">
<a class="site-brand-inner" rel="author" href="/">
  <img class="site-favicon" title="That C# guy" src="" onerror="this.style.display='none'">
  That C# guy
</a>
      </span>

      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="https://github.com/fferegrino">GitHub</a>
            <a class="page-link" href="https://twitter.com/io_exception">Twitter</a>
            <a class="page-link" href="https://youtube.com/thatcsharpguy">YouTube</a>
            <a class="page-link" href="https://tcsg.dev/discord">Discord</a>

            <span class="page-link">

  <div id="google_translate_element" style="display: none;"></div>
  <span class="ct-language">
     <ul class="list-unstyled ct-language-dropdown">
       <li>
          <a href="#" class="lang-select" data-lang="es">
          <img src="https://www.countryflags.io/mx/flat/64.png" title="M茅xico">
          </a>
       </li>
        <li>
           <a href="#" class="lang-select" data-lang="en">
           <img src="https://www.countryflags.io/gb/flat/64.png" title="English">
           </a>
        </li>
        <li>
           <a href="#" class="lang-select" data-lang="fr">
           <img src="https://www.countryflags.io/fr/flat/64.png" title="Franch">
           </a>
        </li>
        <li>
           <a href="#" class="lang-select" data-lang="zh-CN">
           <img src="https://www.countryflags.io/cn/flat/64.png" title="Chinese(Simple)">
           </a>
        </li>
        <li>
           <a href="#" class="lang-select" data-lang="ja">
           <img src="https://www.countryflags.io/jp/flat/64.png" title="Japan">
           </a>
        </li>
        <li>
           <a href="#" class="lang-select" data-lang="ko">
           <img src="https://www.countryflags.io/kr/flat/64.png" title="Korean">
           </a>
        </li>
        <li>
           <a href="#" class="lang-select" data-lang="ru">
           <img src="https://www.countryflags.io/ru/flat/64.png" title="Russia">
           </a>
        </li>
     </ul>
  </span>
  <script type="text/javascript">
     function googleTranslateElementInit() {
       new google.translate.TranslateElement({
         pageLanguage: '',
         autoDisplay: false,
         layout: google.translate.TranslateElement.InlineLayout.VERTICAL
       }, 'google_translate_element');
     
       function restoreLang() {
         var iframe = document.getElementsByClassName('goog-te-banner-frame')[0];
         if (!iframe) return;
     
         var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
         var restore_el = innerDoc.getElementsByTagName("button");
     
         for (var i = 0; i < restore_el.length; i++) {
           if (restore_el[i].id.indexOf("restore") >= 0) {
             restore_el[i].click();
             var close_el = innerDoc.getElementsByClassName("goog-close-link");
             close_el[0].click();
             return;
           }
         }
       }
     
       function triggerHtmlEvent(element, eventName) {
         var event;
         if (document.createEvent) {
           event = document.createEvent('HTMLEvents');
           event.initEvent(eventName, true, true);
           element.dispatchEvent(event);
         } else {
           event = document.createEventObject();
           event.eventType = eventName;
           element.fireEvent('on' + event.eventType, event);
         }
       }
     
       var googleCombo = document.querySelector("select.goog-te-combo");
       var langSelect = document.querySelector('.ct-language');
       langSelect.addEventListener('click', function(event) {
         if (!event.target) {
           return;
         }
     
         var selected = document.querySelector('.ct-language .ct-language-selected');
         if (selected) {
           selected.classList.remove('ct-language-selected');
         }
     
         var target = event.target;
         while (target && target !== langSelect ) {
           if (target.matches('.lang-select')) {
             break;
           }
           target = target.parentElement;
         }
     
         if (target && target.matches('.lang-select')) {
           var lang = target.getAttribute('data-lang');
           if (lang == "es") {
             restoreLang();
           } else {
             target.parentElement.classList.add('ct-language-selected');
             googleCombo.value = lang;
             triggerHtmlEvent(googleCombo, 'change');
           }
         }
     
         event.preventDefault();
       });
     }
  </script>
  <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</span>            </span>
            
        </div>
      </nav>
    </div>
  </div>
</header>

<script>
  (function() {
    var lastScrollY = getScrollPos().y;
    var documentElement = document.documentElement;

    function storeScrollData() {
      var y = getScrollPos().y;


      var scrollStatus = "";

      if (y <= 0) {
        scrollStatus = "top";
      } else if ((window.innerHeight + y) >= document.body.offsetHeight) {
        scrollStatus = "bottom";
      } else {
        var isScrollDown = (y - lastScrollY > 0) ? true : false;
        scrollStatus = isScrollDown ? "down" : "up";
      }

      lastScrollY = y;
      documentElement.setAttribute("data-scroll-status", scrollStatus);
    }

    window.addEventListener('scroll', function(e) {
      storeScrollData();
    });

    storeScrollData();
  })();
</script>























<script>
  function hashLocate(hashValue) {
    hashValue = hashValue.replace(/^.*#h-/, '');
    var element = document.getElementById(hashValue);

    if (!element) {
      return;
    }

    var header = document.querySelector('header.site-header');
    var headerRect = header.getBoundingClientRect();
    var headerTop = Math.floor(headerRect.top);
    var headerHeight = Math.floor(headerRect.height);
    var scrollPos = getScrollPos();
    var offsetY = element.offsetTop - (headerTop + headerHeight + 20);

    if (offsetY == scrollPos.y) {
      return;
    }

    if (headerTop == 0  && offsetY > scrollPos.y) {
      offsetY += headerHeight + 2;
    } else if (headerTop < 0  && offsetY < scrollPos.y) {
      offsetY -= headerHeight - 2;
    }

    smoothScrollTo(offsetY);
  }

  // The first event occurred
  window.addEventListener('load', function(event) {
    if (window.location.hash) {
      hashLocate(window.location.hash);
    }
  });

  // The first event occurred
  window.addEventListener('click', function(event) {
    if (event.target.tagName.toLowerCase() == 'a') {
      hashLocate(event.target.getAttribute('href'));
    }
  });
</script>

<div class="theme-toggle">
  <input type="checkbox" id="theme-switch">
  <label for="theme-switch">
    <div class="toggle"></div>
    <div class="names">
      <p class="light"><i class="fas fa-sun"></i></p>
      <p class="dark"><i class="fas fa-moon"></i></p>
    </div>
  </label>
</div>





<script>
  (function() {
    var sw = document.getElementById('theme-switch');
    var html = document.getElementsByTagName('html')[0];
    var nightModeOption = ('' || 'auto').toLowerCase();
    var storage = nightModeOption === 'manual'
        ? localStorage
        : sessionStorage;
    var themeData = loadThemeData();

    function saveThemeData(data) {
      storage.setItem('theme', JSON.stringify(data));
    }

    function loadThemeData() {
      var data = storage.getItem('theme');
      try {
        data = JSON.parse(data ? data : '');
      } catch(e) {
        data = { nightShift: undefined, autoToggleAt: 0 };
        saveThemeData(data);
      }
      return data;
    }

    function handleThemeToggle(nightShift) {
      themeData.nightShift = nightShift;
      saveThemeData(themeData);
      html.dataset.theme = nightShift ? 'dark' : 'light';
      setTimeout(function() {
        sw.checked = nightShift ? true : false;
      }, 50);
    }

    function autoThemeToggle() {
      // Next time point of theme toggle
      var now = new Date();
      var toggleAt = new Date();
      var hours = now.getHours();
      var nightShift = hours >= 19 || hours <=7;

      if (nightShift) {
        if (hours > 7) {
          toggleAt.setDate(toggleAt.getDate() + 1);
        }
        toggleAt.setHours(7);
      } else {
        toggleAt.setHours(19);
      }

      toggleAt.setMinutes(0);
      toggleAt.setSeconds(0);
      toggleAt.setMilliseconds(0)

      var delay = toggleAt.getTime() - now.getTime();

      // auto toggle theme mode
      setTimeout(function() {
        handleThemeToggle(!nightShift);
      }, delay);

      return {
        nightShift: nightShift,
        toggleAt: toggleAt.getTime()
      };
    }

    // Listen the theme toggle event
    sw.addEventListener('change', function(event) {
      handleThemeToggle(event.target.checked);
    });

    if (nightModeOption == 'auto') {
      var data = autoThemeToggle();

      // Toggle theme by local setting
      if (data.toggleAt > themeData.autoToggleAt) {
        themeData.autoToggleAt = data.toggleAt;
        handleThemeToggle(data.nightShift);
      } else {
        handleThemeToggle(themeData.nightShift);
      }
    } else if (nightModeOption == 'manual') {
      handleThemeToggle(themeData.nightShift);
    } else {
      var nightShift = themeData.nightShift;
      if (nightShift === undefined) {
        nightShift = nightModeOption === 'on';
      }
      handleThemeToggle(nightShift);
    }
  })();
</script>

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        
<div class="framework">
  <section class="main">
     
<div class="post">
  <section>
    

<header class="post-header">
  <h1 class="post-title p-name" itemprop="name headline">Publicando aplicaciones hechas con Xamarin desde GitHub Actions</h1>
  <!-- <h3 class="post-subtitle">Ingenier&#237;a de software + Ciencia de datos + MLOps</h3> -->

  <p class="post-meta">
    <time class="dt-published" datetime="" itemprop="datePublished">
      <i class="fas fa-calendar"></i> July 25, 2020
    </time>
    
    <span class="post-reading-time left-vsplit"><i class="fas fa-user"></i> Antonio Feregrino</span>
  </p>

  <div class="post-tags">
    <!-- <a class="post-tag" href="/tag/xamarin">#xamarin</a> -->
    <a class="post-tag" href="#">#xamarin</a>
    <!-- <a class="post-tag" href="/tag/xamairn-forms">#xamairn-forms</a> -->
    <a class="post-tag" href="#">#xamairn-forms</a>
    <!-- <a class="post-tag" href="/tag/github">#github</a> -->
    <a class="post-tag" href="#">#github</a>
    <!-- <a class="post-tag" href="/tag/github-actions">#github-actions</a> -->
    <a class="post-tag" href="#">#github-actions</a>
  </div>

</header>

    <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
      <div class="post-content e-content" itemprop="articleBody">
         
<p>La combinaci贸n de integraci贸n y despliegue continuo es fant谩stica, no hay nada mejor que la sensaci贸n de saber que tus cambios estar谩n en producci贸n tan r谩pido como sea posible; adem谩s de evitarte el tedio de tener que hacer el <em>deployment</em> manualmente, que en el caso de Xamarin.Forms es un doble dolor: publicar en la App Store y Google Play.</p>
<p>En este peque帽o tutorial les voy a mostrar c贸mo es que podemos usar las herramientas a nuestro alcance para lograr simplificar el proceso de publicaci贸n de apps usando GitHub Actions; ahora, mientras que aqu铆 hablo sobre Actions en espec铆fico, esto no implica que puedas llevar las mismas ideas a tu herramienta favorita de <em>CI</em>.</p>
<h3 id="requerimientos">Requerimientos</h3>
<p>Vamos a usar <em>GPG</em> para proteger los archivos necesarios para publicar, si no tienes <code>gpg</code> instalada en tu Mac, la puedes instalar con <code> brew install gpg</code>. Idealmente cuentas con una Mac, sin embargo, no te preocupes si ese no es el caso, puedes continuar leyendo el tutorial y aplicar las ideas en tu computadora Windows.</p>
<p>Una contrase帽a (vamos a llamarla <code>DECRYPT_KEY</code>) para encriptar archivos mediante <em>gpg</em>, te recomiendo que sea generada autom谩ticamente. Gen茅rala y tenla a la mano porque la vamos a utilizar unas cuantas veces en este post.</p>
<p>Idealmente ya cuentas con conocimiento de c贸mo publicar tus apps en las tiendas.</p>
<h1 id="ios">iOS</h1>
<h2 id="obteniendo-un-certificado-de-publicacion-para-ios">Obteniendo un certificado de publicaci贸n para iOS</h2>
<p>Te recomiendo generar un certificado de publicaci贸n para cada app que desarrolles, aunque, este certificado lo puedes compartir entre varias, puesto que este certificado te identifica a ti como quien publica la app. En este caso, ser谩 el servidor de GitHub el que publique y al que t煤 le estar谩s dando permiso de autenticarse como tu.</p>
<ul>
<li>Para generar un certificado nuevo, visita <a href="https://developer.apple.com/account/resources/certificates/list">https://developer.apple.com/account/resources/certificates/list</a>, elige &quot;Crear un nuevo certificado&quot; y selecciona &quot;Apple Distribution&quot;:</li>
</ul>
<p><img src="https://imgur.com/b6T6YYw.png" alt="elige &quot;Crear un nuevo certificado&quot; y selecciona &quot;Apple Distribution&quot;" /></p>
<ul>
<li>Una vez creado, descarga el certificado e inst谩lalo en tu computadora. Para instalarlo simplemente da doble click en el archivo que acabas de descargar.</li>
</ul>
<p><img src="https://i.imgur.com/XXThK37.png" alt="descarga el certificado e inst谩lalo en tu computadora" /></p>
<ul>
<li>El siguiente paso es crear y descargar un perfil de publicaci贸n para tu app:</li>
</ul>
<p><img src="https://i.imgur.com/6CodfmN.png" alt="El siguiente paso es crear y descargar un perfil de publicaci贸n para tu app" /></p>
<ul>
<li>Elige &quot;Distribution&quot; y &quot;App Store&quot;:</li>
</ul>
<p><img src="https://i.imgur.com/TbrqVrY.png" alt="Elige &quot;Distribution&quot; y &quot;App Store&quot;" /></p>
<ul>
<li>Elige despu茅s el identificador de tu aplicaci贸n:</li>
</ul>
<p><img src="https://i.imgur.com/0eCLTi0.png" alt="Elige despu茅s el identificador de tu aplicaci贸n" /></p>
<ul>
<li>Aseg煤rate tambi茅n que elijas el certificado adecuado, justamente el que creamos en el paso anterior.</li>
</ul>
<p><img src="https://i.imgur.com/pIKkXbl.png" alt="Aseg煤rate tambi茅n que elijas el certificado adecuado" /></p>
<ul>
<li>Establece un nombre descriptivo, y genera el perfil de publicaci贸n.</li>
</ul>
<p><img src="https://i.imgur.com/peJlpOZ.png" alt="Establece un nombre descriptivo, y genera el perfil de publicaci贸n" /></p>
<ul>
<li>El siguiente paso es descargar y abrir el perfil de publicaci贸n, si Xcode no est谩 abierto, el abrir el perfilde publicaci贸n lo abrir谩. Una vez hecho esto, podemos configurar nuestra app para usarlos al momento de crear el archivo que vamos a publicar en la App Store.</li>
</ul>
<h2 id="configura-tu-app-para-usar-los-certificados">Configura tu app para usar los certificados</h2>
<p>El siguiente paso es configurar tu aplicaci贸n de Xamarin.iOS (o tu aplicaci贸n de iOS normal), la opci贸n a elegir en Xamarin es &quot;iOS Bundle Signing&quot;, aseg煤rate de que en la Configuraci贸n est茅 seleccionada la opci贸n <code>Release</code> y de que como plataforma est茅 elegida <code>iPhone</code>. Luego entonces selecciona el certificado y el perfil de aprovisionamiento que acabamos de crear.</p>
<p><img src="https://i.imgur.com/zJGWRBu.png" alt="Configura tu app para usar los certificados" /></p>
<h2 id="colocando-los-certificados-en-github">Colocando los certificados en GitHub</h2>
<blockquote>
<p>ㄢ锔 隆Mucho cuidado! 隆aseg煤rate de no subir ninguno de los siguientes archivos a menos de que est茅n encriptados! 锔</p>
</blockquote>
<h3 id="exportando-el-certificado">Exportando el certificado</h3>
<p><img src="https://i.imgur.com/G0pF2C0.png" alt="Exportando el certificado" /></p>
<p><img src="https://i.imgur.com/hByhz7g.png" alt="Exportando el certificado" /></p>
<p>Guarda el archivo con el nombre <code>Certificates.p12</code> dentro de la carpeta <code>secrets</code>.</p>
<p><img src="https://i.imgur.com/5gT22K6.png" alt="Guarda el archivo con el nombre Certificates.p12 dentro de la carpeta secrets" /></p>
<h3 id="exportando-los-perfiles-de-publicacion">Exportando los perfiles de publicaci贸n</h3>
<p>Lo primero es descubrir cu谩l es el perfil de publicaci贸n que corresponde al que acabamos de descargar, para hacerlo, lista los perfiles con el siguiente comando:</p>
<pre><code class="language-bash">ls -lah ~/Library/MobileDevice/Provisioning\ Profiles/
</code></pre>
<p>En este caso, el m谩s reciente es el que corresponde al perfil de publicaci贸n de nuestra app, tiene el identificador <code>f3b9e904-6d99-409a-91f4-440c5b79565d</code>:</p>
<p><img src="https://i.imgur.com/9cEkq9v.png" alt="En este caso, el m谩s reciente es el que corresponde al perfil de publicaci贸n de nuestra app" /></p>
<p>El siguiente paso es copiar el perfil a la carpeta <code>secrets</code>.</p>
<pre><code class="language-bash">cp ~/Library/MobileDevice/Provisioning\ Profiles/f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision secrets
</code></pre>
<p>Toma nota de este identificador porque lo ver谩s en muchos lados, el m铆o es <code>f3b9e904-6d99-409a-91f4-440c5b79565d</code> pero el tuyo sera diferente.</p>
<h3 id="encriptando-nuestros-secretos">Encriptando nuestros secretos</h3>
<p>Como lo mencion茅 al inicio de esta secci贸n, no podemos subir nuestros secretos (l茅ase el certificado y el perfil de publicaci贸n) as铆 como as铆 a GitHub, antes hay que protegerlos mediante la encriptaci贸n. Usaremos <em>gpg</em> y la contrase帽a que creaste al inicio de este post.</p>
<pre><code class="language-bash">gpg --symmetric --cipher-algo AES256 Certificates.p12
gpg --symmetric --cipher-algo AES256 f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision
</code></pre>
<p>Despu茅s de esto, deber谩s tener un par de archivos con el mismo nombre que los anteriores, pero con <code>.gpg</code> como extensi贸n:</p>
<pre><code class="language-bash">Certificates.p12.gpg
f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision.gpg
</code></pre>
<p>Solo para asegurarnos de que no vamos a publicar nuestros secretos al descubierto, los eliminamos:</p>
<pre><code class="language-bash">rm Certificates.p12
rm f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision
</code></pre>
<h3 id="desencriptando-el-certificado-en-github">Desencriptando el certificado en GitHub</h3>
<p>Una vez que nuestros archivos est谩n en GitHub encriptados, debemos hacer posible desencriptarlos dentro de la ejecuci贸n de nuestro flujo de trabajo:</p>
<ul>
<li>Desencriptar los secretos usando el password almacenado en &quot;DECRYPT_KEY&quot;</li>
</ul>
<pre><code class="language-bash">gpg --quiet --batch --yes --decrypt --passphrase=&quot;$DECRYPT_KEY&quot; --output ./secrets/f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision ./secrets/f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision.gpg
gpg --quiet --batch --yes --decrypt --passphrase=&quot;$DECRYPT_KEY&quot; --output ./secrets/Certificates.p12 ./secrets/Certificates.p12.gpg
</code></pre>
<ul>
<li>Crea la carpeta &quot;Provisioning Profiles&quot; en la computadora que est谩 ejecutando las acciones de GitHub</li>
</ul>
<pre><code class="language-bash">mkdir -p ~/Library/MobileDevice/Provisioning\ Profiles
</code></pre>
<ul>
<li>Copia el perfil de publicaci贸n a la carpeta reci茅n creada</li>
</ul>
<pre><code class="language-bash">cp ./secrets/f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision ~/Library/MobileDevice/Provisioning\ Profiles/f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision
</code></pre>
<ul>
<li>Crea un Keychain e importa el archivo Certificates.p12</li>
</ul>
<pre><code class="language-bash">security create-keychain -p &quot;&quot; build.keychain
security import ./secrets/Certificates.p12 -t agg -k ~/Library/Keychains/build.keychain -P &quot;&quot; -A
</code></pre>
<ul>
<li>Establece el Keychain recien creado como default</li>
</ul>
<pre><code class="language-bash">security list-keychains -s ~/Library/Keychains/build.keychain
security default-keychain -s ~/Library/Keychains/build.keychain
security unlock-keychain -p &quot;&quot; ~/Library/Keychains/build.keychain
security set-key-partition-list -S apple-tool:,apple: -s -k &quot;&quot; ~/Library/Keychains/build.keychain
</code></pre>
<p>Todas las instrucciones anteriores debemos colocarlas en un archivo llamado <code>decrypt_secrets.sh</code> dentro de nuestra carpeta <code>secrets</code>, no te olvides de darle permisos de ejecuci贸n a este archivo mediante el siguiente comando:</p>
<pre><code>chmod +x secrets/decrypt_secrets.sh
</code></pre>
<h2 id="compilando-la-app">Compilando la app</h2>
<p>El siguiente paso en el flujo de trabajo es compilar la aplicaci贸n de tal modo que nos genere un archivo <code>.ipa</code> que podemos cargar directamente en la App Store, para esta tarea usaremos <code>msbuild</code>:</p>
<pre><code class="language-bash">nuget restore
msbuild \
  /p:Configuration=Release \
  /p:Platform=iPhone \
  /p:BuildIpa=true \
  /target:Build \
  PinCountdown.iOS/PinCountdown.iOS.csproj
</code></pre>
<p>Primero estamos restaurando todos los paquetes de NuGet, luego le indicamos que queremos compilar la aplicaci贸n usando la configuraci贸n <code>Release</code>, adem谩s de que queremos que compile el archivo Ipa, y lo apuntamos al proyecto de iOS, que en mi caso est谩 en <code>PinCountdown.iOS/PinCountdown.iOS.csproj</code>.</p>
<h2 id="publicando-en-itunes-connect">Publicando en iTunes Connect</h2>
<p>El siguiente paso es publicar nuestro archivo <code>.ipa</code> en la App Store, para ello vamos a usar una herramienta que nos ofrece Xcode:</p>
<pre><code class="language-bash">xcrun altool --upload-app -t ios \
  -f PinCountdown.iOS/bin/iPhone/Release/PinCountdown.iOS.ipa \
  -u &quot;$&quot; -p &quot;$&quot;
</code></pre>
<p>Le estamos indicando a <code>xcrun</code> que nuestro archivo a subir est谩 en al carpeta <code>PinCountdown.iOS/bin/iPhone/Release/</code>, adem谩s de indicarle nuestras credenciales mediante secretos de GitHub, de los cuales hablaremos a continuaci贸n.</p>
<h2 id="configurando-github">Configurando GitHub</h2>
<p>Ahora, es necesario configurar nuestro repositorio con los secretos que vamos a usar para publicar nuestra app, para esto nos dirigimos a <em>Configuraci贸n &gt; Secretos</em></p>
<p><img src="https://imgur.com/AP4VRrl.png" alt="Ahora, es necesario configurar nuestro repositorio con los secretos que vamos a usar para publicar nuestra app, para esto nos dirigimos a Configuraci贸n &gt; Secretos" />
Hay que a帽adir tres nuevos secretos:</p>
<ul>
<li><code>DECRYPT_KEY</code>: la contrase帽a que usamos para encriptar los secretos</li>
<li><code>APPLEID_USERNAME</code>: la cuenta de correo electr贸nico para acceder a iTunes Connect (para mayor seguridad, puedes crear una cuenta de correo espec铆fica para cada app)</li>
<li><code>APPLEID_PASSWORD</code>: la contrase帽a de la cuenta de iTunes Connect</li>
</ul>
<h1 id="android">Android</h1>
<h2 id="generando-una-keystore">Generando una <code>keystore</code></h2>
<p>Vamos a generar un primer APK de nuestra app porque hay que subir primero na versi贸n manualmente (gracias Google), y de paso generamos un nuevo <code>keystore</code>.  Ojo que si ya publicaste una versi贸n de tu app usando otro <code>keystore</code>, ese es el que debes usar en lugar de generar uno nuevo.</p>
<ul>
<li>Da click derecho en tu aplicaci贸n de Xamarin.Android y selecciona <em>&quot;Archivar para publicaci贸n&quot;</em></li>
</ul>
<p><img src="https://imgur.com/3egO8Q0.png" alt="Da click derecho en tu aplicaci贸n de Xamarin.Android y selecciona &quot;Archivar para publicaci贸n&quot;" /></p>
<ul>
<li>Una vez terminada la compilaci贸n, da click derecho en el archivo reci茅n creado y selecciona <em>Firmar y distribu铆r</em></li>
</ul>
<p><img src="https://i.imgur.com/2hk1gX0.png" alt="Una vez terminada la compilaci贸n, da click derecho en el archivo reci茅n creado y selecciona Firmar y distribu铆r" /></p>
<ul>
<li>Selecciona el m茅todo de distribuci贸n <em>Ad Hoc</em></li>
</ul>
<p><img src="https://i.imgur.com/rsVmRGw.png" alt="Selecciona el m茅todo de distribuci贸n Ad Hoc" /></p>
<ul>
<li>Para crear una nueva <em>keystore</em>, selecciona <em>Crear una nueva llave</em></li>
</ul>
<p><img src="https://i.imgur.com/P7g1BFz.png" alt="Para crear una nueva keystore, selecciona Crear una nueva llave" /></p>
<ul>
<li>En la siguiente ventana, selecciona un alias para tu <em>keystore</em>, establece un alias y una contrase帽a, recuerda esta contrase帽a, vamos a llamarla <code>KEYSTORE_PASS</code></li>
</ul>
<p><img src="https://i.imgur.com/jwfIDZ3.png" alt="En la siguiente ventana, selecciona un alias para tu keystore, establece un alias y una contrase帽a" /></p>
<ul>
<li>Una vez creada, da click derecho para ver mayor informaci贸n sobre la llave que acabas de crear</li>
</ul>
<p><img src="https://i.imgur.com/9254zZ4.png" alt="Una vez creada, da click derecho para ver mayor informaci贸n sobre la llave que acabas de crear" /></p>
<ul>
<li>Toma nota de la direcci贸n de tu <em>keystore</em>, la vamos a usar m谩s adelante</li>
</ul>
<p><img src="https://i.imgur.com/oKRhomm.png" alt="Toma nota de la direcci贸n de tu keystore, la vamos a usar m谩s adelante" /></p>
<ul>
<li>Por 煤ltimo, continua con la publicaci贸n natural de tu app y c谩rgala a la Google Play Store, recuerda que es necesario publicar la primera versi贸n manualmente.</li>
</ul>
<h2 id="cargando-la-keystore-a-github">Cargando la <em>keystore</em> a GitHub</h2>
<p>Al igual que como hicimos con nuestros certificados de iOS, es necesario que carguemos nuestra <em>keystore</em> a GitHub, desde luego, debemos protegerla primero usando <em>gpg</em>.</p>
<p>驴Recuerdas la direcci贸n de la <em>keystore</em> que obtuvimos en el paso anterior? es hora de usarla para copiar la <em>keystore</em> en nuestra carpeta <code>secrets</code>:</p>
<pre><code class="language-bash">cp /Users/antonioferegrino/Library/Developer/Xamarin/Keystore/PinCountdown/PinCountdown.keystore ./secrets/PinCountdown.keystore
</code></pre>
<p>Encriptamos, usando nuevamente nuestra contrase帽a <code>DECRYPT_KEY</code> que generamos al incio:</p>
<pre><code class="language-bash">cd secrets
gpg --symmetric --cipher-algo AES256 PinCountdown.keystore
</code></pre>
<p>Por 煤ltimo borramos el archivo <code>PinCountdown.keystore</code>, dejando solamente <code>PinCountdown.keystore.gpg</code> (adem谩s de los otros <code>.gpg</code> correspondientes a iOS):</p>
<pre><code class="language-bash">rm PinCountdown.keystore
</code></pre>
<p>No te olvides de colocar tus cambios en GitHub, para que ahora tu <em>keystore</em> est茅 protegida dentro del control de versiones.</p>
<h2 id="desencriptando-la-keystore-en-github">Desencriptando la <em>keystore</em> en GitHub</h2>
<p>Coloca las siguientes l铆neas dentro del archivo <code>secrets/decrypt_secrets.sh</code> :</p>
<pre><code class="language-bash">gpg --quiet --batch --yes --decrypt --passphrase=&quot;$DECRYPT_KEY&quot; --output ./secrets/PinCountdown.keystore ./secrets/PinCountdown.keystore.gpg
</code></pre>
<h2 id="compilando-la-app-1">Compilando la app</h2>
<pre><code class="language-bash">nuget restore
msbuild \
  /p:Configuration=Release \
  /p:Platform=AnyCPU \
  /target:SignAndroidPackage \
  /p:AndroidSigningKeyAlias=&quot;PinCountdown&quot; \
  /p:AndroidSigningKeyPass='$' \
  /p:AndroidSigningStorePass='$'  \
  /p:AndroidKeyStore=&quot;true&quot; \
  /p:AndroidSigningKeyStore=&quot;./secrets/PinCountdown.keystore&quot; \
  PinCountdown.Android/PinCountdown.Android.csproj
</code></pre>
<p>Con ese comando tan largo de <em>msbuild</em> le estamos indicando que queremos generar un paquete de Android en la configuraci贸n <code>Release</code>, junto con todos los detalles correspondientes a la <em>keystore</em> que vamos a usar para ese prop贸sito.</p>
<h2 id="cargando-nuestro-archivo-a-la-google-play-store">Cargando nuestro archivo a la Google Play Store</h2>
<p>Para este paso no es necesario hacer nada <em>&quot;manualmente&quot;</em>, solamente tenemos que usar la acci贸n <a href="https://github.com/r0adkll/upload-google-play">r0adkll/upload-google-play@v1</a> (que tendr谩s que configurar separadamente). El archivo de nuestro <code>apk</code> firmado est谩 siempre dentro de la carpeta <code>bin/Release</code> del proyecto, en el caso de la app que he usado para este proyecto, el archivo est谩 en: <code>PinCountdown.Android/bin/Release/com.messier16.pincountdown-Signed.apk</code>.</p>
<h2 id="configurando-github-1">Configurando GitHub</h2>
<p>En este 煤ltimo paso resta agregar un nuevo secreto, en esta ocasi贸n el secreto <code>KEYSTORE_PASS</code>, que corresponde a la clave que establecimos en un paso anterior. Y listo, eso es todo para la configuraci贸n.</p>
<h1 id="configurando-github-actions">Configurando GitHub actions</h1>
<p>A continuaci贸n les muestro el archivo que pone todas las piezas en su lugar, esta es la configuraci贸n del <em>pipeline</em> de GitHub actions, en teor铆a, todos los pasos los describimos previamente y aqu铆 solo resta usarlos.</p>
<pre><code class="language-yaml">name: Build the app
on: push
jobs:
  build:
    runs-on: macOS-latest
    steps:

      - name: Checkout repo
        uses: actions/checkout@v1

      - name: Decrypt Secrets
        run: ./secrets/decrypt_secrets.sh
        env:
          DECRYPT_KEY: $

      - name: iOS Build
        run: |
          nuget restore
          msbuild \
            /p:Configuration=Release \
            /p:Platform=iPhone \
            /p:BuildIpa=true \
            /target:Build \
            PinCountdown.iOS/PinCountdown.iOS.csproj

      - name: Android Build
        run: |
          nuget restore
          msbuild \
            /p:Configuration=Release \
            /p:Platform=AnyCPU \
            /target:SignAndroidPackage \
            /p:AndroidSigningKeyAlias=&quot;PinCountdown&quot; \
            /p:AndroidSigningKeyPass='$' \
            /p:AndroidSigningStorePass='$' \
            /p:AndroidKeyStore=&quot;true&quot; \
            /p:AndroidSigningKeyStore=&quot;$PWD/secrets/PinCountdown.keystore&quot; \
            PinCountdown.Android/PinCountdown.Android.csproj

      - name: Save generated IPA
        uses: actions/upload-artifact@v2
        with:
          name: PinCountdown.iOS.ipa
          path: PinCountdown.iOS/bin/iPhone/Release/PinCountdown.iOS.ipa

      - name: Save generated APK
        uses: actions/upload-artifact@v2
        with:
          name: PinCountdown.Android.apk
          path: PinCountdown.Android/bin/Release/com.messier16.pincountdown-Signed.apk

      - name: Publish to App Store
        run: |
          xcrun altool --upload-app -t ios \
            -f PinCountdown.iOS/bin/iPhone/Release/PinCountdown.iOS.ipa \
            -u &quot;$&quot; -p &quot;$&quot;

      - name: Publish to Play Store
        uses: r0adkll/upload-google-play@v1
        with:
          serviceAccountJsonPlainText: $
          packageName: com.messier16.pincountdown
          releaseFile: PinCountdown.Android/bin/Release/com.messier16.pincountdown-Signed.apk
          track: alpha
</code></pre>
<p>Puedes ver todos los cambios que hice en <a href="https://github.com/messier16/pin-countdown/pull/1/files">esta Pull Request</a>.</p>
<h2 id="errores-comunes-y-consejos">Errores comunes y consejos</h2>
<p>He de aceptarlo, poner todas las piezas juntas me cost贸 un poco de trabajo, adem谩s de <a href="https://twitter.com/io_exception/status/1282370753279725570">consumir todos mis minutos disponibles en Actions</a> porque estaba probando en un repositorio privado. As铆 que con el objetivo de hacer el proceso m谩s sencillo para ti te dejo estos consejos:</p>
<ul>
<li><p><strong>Cada que vas a publicar en las tiendas, debes cambiar el n煤mero de versi贸n de tu app</strong>: Las tiendas de aplicaciones son muy estrictas en cuanto a las versiones que publicas de tu app, en el sentido de que no puedes publicar la misma versi贸n dos veces. Te invito a que veas mi post sobre <a href="http://feregrino.dev/versioning-any-app-with-python.html">c贸mo versionar cualquier app con Python</a> para que veas una manera de hacerlo autom谩ticamente.</p>
</li>
<li><p><strong>Aseg煤rate de que el <em>pipeline</em>  que publica solamente se ejecute cuando quieres publicar</strong>: si te fijas en el <em>yaml</em> anterior, tenemos configurado GitHub actions para que se ejecute cada vez que alguien hace <em>push</em> al repo, causando que estemos publicando nuestras apps constantemente; el problema es mayor si ignoramos el punto anterior (cada nueva publicaci贸n en las tiendas requiere una nueva versi贸n). Una soluci贸n para este problema es la de solamente ejecutar este <em>pipeline</em> cuando etiquetamos un commit:</p>
</li>
</ul>
<pre><code class="language-yaml">on:
  push:
    tags:
      - '*'
</code></pre>
<ul>
<li><strong>Guarda todas las contrase帽as que uses</strong>: no podr谩s recuperar ninguna contrase帽a de las que guardes como secretos de GitHub, es importante que las mantengas a salvo en otro lado en donde si las puedas recuperar.</li>
</ul>
<h2 id="dudas">驴Dudas?</h2>
<p>Encu茅ntrame en <a href="https://twitter.com/io_exception">https://twitter.com/io_exception</a>, en donde con todo gusto responder茅 cualquier duda que tengas.</p>


      </div>
  </article>




  </section>
</div>

  </section>
  <section class="sidebar" style="margin-left: 15px;">
<style type="text/css" media="screen">
.post-menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
</style>

<div class="post-menu">
  <div class="post-menu-title">TOC</div>
  <div class="post-menu-content"></div>
</div>

<script>
  function generateContent() {
    var menu = document.querySelector(".post-menu");
    var menuContent =  menu.querySelector(".post-menu-content");
    var headings = document.querySelector(".post-content").querySelectorAll("h2, h3, h4, h5, h6");

    // Hide menu when no headings
    if (headings.length === 0) {
      return menu.style.display = "none";
    }

    // Generate post menu
    var menuHTML = '';
    for (var i = 0; i < headings.length; i++) {
      var h = headings[i];
      menuHTML += (
        '<li class="h-' + h.tagName.toLowerCase() + '">'
        + '<a href="#h-' + h.getAttribute('id') + '">' + h.textContent + '</a></li>');
    }

    menuContent.innerHTML = '<ul>' + menuHTML + '</ul>';

    // The header element
    var header = document.querySelector('header.site-header');

    function doMenuCollapse(index, over_items) {
      var items = menuContent.firstChild.children;

      if (over_items == undefined) {
        over_items = 20;
      }

      if (items.length < over_items) {
        return;
      }

      var activeItem = items[index];
      var beginItem = activeItem
      var endItem = activeItem
      var beginIndex = index;
      var endIndex = index + 1;
      while (beginIndex >= 0
        && !items[beginIndex].classList.contains('h-h2')) {
        beginIndex -= 1;
      }
      while (endIndex < items.length
        && !items[endIndex].classList.contains('h-h2')) {
        endIndex += 1;
      }
      for (var i = 0; i < beginIndex; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
      for (var i = beginIndex + 1; i < endIndex; i++) {
        item = items[i]
        // if (!item.classList.contains('h-h2')) {
          item.style.display = '';
        // }
      }
      for (var i = endIndex; i < items.length; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
    }

    // Init menu collapsed
    doMenuCollapse(-1);

    // Active the menu item
    window.addEventListener('scroll', function (event) {
      var lastActive = menuContent.querySelector('.active');
      var changed = true;
      var activeIndex = -1;
      for (var i = headings.length - 1; i >= 0; i--) {
        var h = headings[i];
        var headingRect = h.getBoundingClientRect();
        var headerRect = header.getBoundingClientRect();
        var headerTop = Math.floor(headerRect.top);
        var headerHeight = Math.floor(headerRect.height);
        var headerHeight = headerTop + headerHeight + 20;
        if (headingRect.top <= headerHeight) {
          var id = 'h-' + h.getAttribute('id');
          var a = menuContent.querySelector('a[href="#' + id  + '"]');
          var curActive = a.parentNode;
          if (curActive) {
            curActive.classList.add('active');
            activeIndex = i;
          }
          if (lastActive == curActive) {
            changed = false;
          }
          break;
        }
      }
      if (changed) {
        if (lastActive) {
          lastActive.classList.remove('active');
        }
        doMenuCollapse(activeIndex);
      }
      event.preventDefault();
    });
  }
  generateContent();
</script>
  </section>
</div>

      </div>
    </main>

<footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">
    <div class="site-footer-inner">
      <div> </div>
      <div>Powered by <a title="Jekyll is a simple, blog-aware, static site
      generator." href="http://jekyllrb.com/">Jekyll</a> &amp; <a title="Yat, yet
      another theme." href="https://github.com/jeffreytse/jekyll-theme-yat">Yat Theme</a>.</div>
      <div class="footer-col rss-subscribe">Subscribe <a href="/feed.xml">via RSS</a></div>
    </div>
  </div>
</footer>

  </body>
</html>
