<!DOCTYPE html>
<html lang="es" itemscope itemtype="http://schema.org/Blog">
    <head>
        <!–– Made with Lockdown: https://github.com/fferegrino/lockdown ––>
  
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-translate-customization" content="108d9124921d80c3-80e20d618ff053c8-g4f02ec6f3dba68b7-c"></meta>

  <link rel="shortcut icon" href="">
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
  <script src="https://kit.fontawesome.com/0271495296.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-noto-sans@0.0.72/index.min.css">
  <link rel="stylesheet" href="/css/main.css">
  <script src="/js/main.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/vs.min.css" integrity="sha512-aWjgJTbdG4imzxTxistV5TVNffcYGtIQQm2NBNahV6LmX14Xq9WwZTL1wPjaSglUuVzYgwrq+0EuI4+vKvQHHw==" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js" integrity="sha512-9GIHU4rPKUMvNOHFOer5Zm2zHnZOjayOO3lZpokhhCtgt8FNlNiW/bb7kl0R5ZXfCDVPcQ8S4oBdNs92p5Nm2w==" crossorigin="anonymous"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script data-ad-client="ca-pub-9566151416325480" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#2176ff">
<meta name="msapplication-TileColor" content="#eeeef2">
<meta name="theme-color" content="#eeeef2">


  <title>Maneja el tiempo con NodaTime | That C# guy</title>

  <!-- Search Engine -->
  <meta name="description" content="Mejora el manejo de las fechas y el tiempo en tu aplicación con NodaTime, muévelas a través de zonas horarias, horarios de verano y en los relojes de todo el mundo sin complicaciones.">
  <meta name="image" content="">
  <!-- Schema.org for Google -->
  <meta itemprop="name" content="Maneja el tiempo con NodaTime">
  <meta itemprop="description" content="Mejora el manejo de las fechas y el tiempo en tu aplicación con NodaTime, muévelas a través de zonas horarias, horarios de verano y en los relojes de todo el mundo sin complicaciones.">
  <meta itemprop="image" content="">
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Maneja el tiempo con NodaTime">
  <meta name="twitter:description" content="Mejora el manejo de las fechas y el tiempo en tu aplicación con NodaTime, muévelas a través de zonas horarias, horarios de verano y en los relojes de todo el mundo sin complicaciones.">
  <meta name="twitter:site" content="@io_exception">
  <meta name="twitter:creator" content="@io_exception">
  <meta name="twitter:image" content="">
  <!-- Open Graph general (Facebook, Pinterest & Google+) -->
  <meta name="og:title" content="Maneja el tiempo con NodaTime">
  <meta name="og:description" content="Mejora el manejo de las fechas y el tiempo en tu aplicación con NodaTime, muévelas a través de zonas horarias, horarios de verano y en los relojes de todo el mundo sin complicaciones.">
  <meta name="og:image" content="">
  <meta name="og:url" content="https://thatcsharpguy.com/">
  <meta name="og:site_name" content="That C# guy">
  <meta name="og:locale" content="es">
  <meta name="og:type" content="website">


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GPXCSH21CP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GPXCSH21CP');
</script>

        
    </head>
    <body style="position: relative; min-height: 100%; top: 0px;">
        <header class="site-header " role="banner">
  <div class="wrapper">
     <div class="site-header-inner">
       <span class="site-brand">
         <a class="site-brand-inner" rel="author" href="/">
          <!-- <img class="site-favicon" title="Your awesome title" src="" onerror="this.style.display='none'"> -->
          That C# guy
        </a>
      </span>
        <nav class="site-nav">
           <input type="checkbox" id="nav-trigger" class="nav-trigger">
           <label for="nav-trigger">
              <span class="menu-icon">
                 <svg viewbox="0 0 18 15" width="18px" height="15px">
                    <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
                 </svg>
              </span>
           </label>
           <div class="trigger">
             <!-- Header links -->
              <a class="page-link" target="_blank" href="https://www.youtube.com/thatcsharpguy/">YOUTUBE</a>
              <span class="page-link">
    <div id="google_translate_element" style="display: none;"></div>
    <span class="ct-language">
       <ul class="list-unstyled ct-language-dropdown">
         <li>
            <a href="#" class="lang-select" data-lang="es">
            <img src="https://www.countryflags.io/mx/flat/64.png" title="México">
            </a>
         </li>
          <li>
             <a href="#" class="lang-select" data-lang="en">
             <img src="https://www.countryflags.io/gb/flat/64.png" title="English">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="fr">
             <img src="https://www.countryflags.io/fr/flat/64.png" title="Franch">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="zh-CN">
             <img src="https://www.countryflags.io/cn/flat/64.png" title="Chinese(Simple)">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="ja">
             <img src="https://www.countryflags.io/jp/flat/64.png" title="Japan">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="ko">
             <img src="https://www.countryflags.io/kr/flat/64.png" title="Korean">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="ru">
             <img src="https://www.countryflags.io/ru/flat/64.png" title="Russia">
             </a>
          </li>
       </ul>
    </span>
    <script type="text/javascript">
       function googleTranslateElementInit() {
         new google.translate.TranslateElement({
           pageLanguage: '',
           autoDisplay: false,
           layout: google.translate.TranslateElement.InlineLayout.VERTICAL
         }, 'google_translate_element');
       
         function restoreLang() {
           var iframe = document.getElementsByClassName('goog-te-banner-frame')[0];
           if (!iframe) return;
       
           var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
           var restore_el = innerDoc.getElementsByTagName("button");
       
           for (var i = 0; i < restore_el.length; i++) {
             if (restore_el[i].id.indexOf("restore") >= 0) {
               restore_el[i].click();
               var close_el = innerDoc.getElementsByClassName("goog-close-link");
               close_el[0].click();
               return;
             }
           }
         }
       
         function triggerHtmlEvent(element, eventName) {
           var event;
           if (document.createEvent) {
             event = document.createEvent('HTMLEvents');
             event.initEvent(eventName, true, true);
             element.dispatchEvent(event);
           } else {
             event = document.createEventObject();
             event.eventType = eventName;
             element.fireEvent('on' + event.eventType, event);
           }
         }
       
         var googleCombo = document.querySelector("select.goog-te-combo");
         var langSelect = document.querySelector('.ct-language');
         langSelect.addEventListener('click', function(event) {
           if (!event.target) {
             return;
           }
       
           var selected = document.querySelector('.ct-language .ct-language-selected');
           if (selected) {
             selected.classList.remove('ct-language-selected');
           }
       
           var target = event.target;
           while (target && target !== langSelect ) {
             if (target.matches('.lang-select')) {
               break;
             }
             target = target.parentElement;
           }
       
           if (target && target.matches('.lang-select')) {
             var lang = target.getAttribute('data-lang');
             if (lang == "es") {
               restoreLang();
             } else {
               target.parentElement.classList.add('ct-language-selected');
               googleCombo.value = lang;
               triggerHtmlEvent(googleCombo, 'change');
             }
           }
       
           event.preventDefault();
         });
       }
    </script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
 </span>
           </div>
        </nav>
     </div>
  </div>
</header>
<script>
  (function() {
    var lastScrollY = getScrollPos().y;
    var documentElement = document.documentElement;

    function storeScrollData() {
      var y = getScrollPos().y;

      documentElement.setAttribute("data-header-transparent", "");

      var scrollStatus = "";
      if (y <= 0) {
        scrollStatus = "top";
      } else if ((window.innerHeight + y) >= document.body.offsetHeight) {
        scrollStatus = "bottom";
      } else {
        var isScrollDown = (y - lastScrollY > 0) ? true : false;
        scrollStatus = isScrollDown ? "down" : "up";
      }
      lastScrollY = y;
      documentElement.setAttribute("data-scroll-status", scrollStatus);
    }
    window.addEventListener('scroll', function(e) {
      storeScrollData();
    });
    storeScrollData();
  })();
</script>
        
        <div class="theme-toggle">
  <input type="checkbox" id="theme-switch"/>
  <label for="theme-switch">
      <div class="toggle"></div>
      <div class="names">
          <p class="light">Light</p>
          <p class="dark">Dark</p>
      </div>
  </label>
</div>
  


<script>
    (function() {
      var sw = document.getElementById('theme-switch');
      var html = document.getElementsByTagName('html')[0];
      var nightModeOption = ('auto' || 'auto').toLowerCase();
      var storage = nightModeOption === 'manual'
          ? localStorage
          : sessionStorage;
      var themeData = loadThemeData();
  
      function saveThemeData(data) {
        storage.setItem('theme', JSON.stringify(data));
      }
  
      function loadThemeData() {
        var data = storage.getItem('theme');
        try {
          data = JSON.parse(data ? data : '');
        } catch(e) {
          data = { nightShift: undefined, autoToggleAt: 0 };
          saveThemeData(data);
        }
        return data;
      }
  
      function handleThemeToggle(nightShift) {
        themeData.nightShift = nightShift;
        saveThemeData(themeData);
        html.dataset.theme = nightShift ? 'dark' : 'light';
        setTimeout(function() {
          sw.checked = nightShift ? true : false;
        }, 50);
      }
  
      function autoThemeToggle() {
        // Next time point of theme toggle
        var now = new Date();
        var toggleAt = new Date();
        var hours = now.getHours();
        var nightShift = hours >= 19 || hours <=7;
  
        if (nightShift) {
          if (hours > 7) {
            toggleAt.setDate(toggleAt.getDate() + 1);
          }
          toggleAt.setHours(7);
        } else {
          toggleAt.setHours(19);
        }
  
        toggleAt.setMinutes(0);
        toggleAt.setSeconds(0);
        toggleAt.setMilliseconds(0)
  
        var delay = toggleAt.getTime() - now.getTime();
  
        // auto toggle theme mode
        setTimeout(function() {
          handleThemeToggle(!nightShift);
        }, delay);
  
        return {
          nightShift: nightShift,
          toggleAt: toggleAt.getTime()
        };
      }
  
      // Listen the theme toggle event
      sw.addEventListener('change', function(event) {
        handleThemeToggle(event.target.checked);
      });
  
      if (nightModeOption == 'auto') {
        var data = autoThemeToggle();
  
        // Toggle theme by local setting
        if (data.toggleAt > themeData.autoToggleAt) {
          themeData.autoToggleAt = data.toggleAt;
          handleThemeToggle(data.nightShift);
        } else {
          handleThemeToggle(themeData.nightShift);
        }
      } else if (nightModeOption == 'manual') {
        handleThemeToggle(themeData.nightShift);
      } else {
        var nightShift = themeData.nightShift;
        if (nightShift === undefined) {
          nightShift = nightModeOption === 'on';
        }
        handleThemeToggle(nightShift);
      }
    })();
  </script>
        <div class="page-content">
            <div class="wrapper">
                <div class="framework">
                    <section class="main"> 
                        
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
    <div class="post-content e-content" itemprop="articleBody">
        
<p>Antes de hablar sobre este tema, te recomiendo que veas este video en donde <a href="https://www.tomscott.com" target="_blank">Tom Soctt</a> habla sobre las dificultades de trabajar con relojes, tiempo y zonas horarias.</p>
<div class="video-wrapper">
    <iframe width="992" height="558" src="https://www.youtube.com/embed/-5wpm-gesOY?cc_load_policy=1&hl=es" frameborder="0" allowfullscreen></iframe>
</div>
<br />
Ahora, y una vez que ya sabes un poco más acerca de lo difícil que puede resultar trabajar con fechas dentro de tu aplicación (especialmente si tu app es un producto utilizado al rededor del mundo y más aún si es una aplicación web con servidores al rededor de todo el mundo), podemos comenzar.
<h1 id="nodatime">NodaTime</h1>
<p>NodaTime es una librería que, una vez que comprendemos los conceptos básicos, nos puede ayudar bastante a trabajar con fechas dentro de nuestra aplicación. En este post únicamente hablaré de apenas la superficie de esta gran librería.</p>
<h2 id="instant">Instant</h2>
<p>La estructura <code>Instant</code> es una de las más importantes dentro de esta librería, podemos ver a cada instancia de esta clase como un momento en el tiempo. Por ejemplo, el momento en el que inicia un partido de fútbol, el momento en el que nace una persona o el momento en el que se realiza una transacción.</p>
<p>Es importante señalar <code>Instant</code> es un <em>momento genérico</em> independiente de todo, no depende de una zona horaria ni de un retraso fijo en el reloj (podríamos decir que siempre está en UTC) ni de un calendario.</p>
<p>Por ejemplo, para obtener el instante actual debemos llamar a la propiedad <code>Now</code> en una instancia de <code>SystemClock</code>, o podemos crear uno con alguno e los métodos <em>factory</em> indicándole el año, mes, día, hora y minutos:</p>
<pre><code class="language-csharp">Instant now = SystemClock.Instance.Now; // UTC
var publicacionPost = Instant.FromUtc(2017, 2, 7, 23, 0); // UTC
</code></pre>
<p>Podrías pensar que no es tan distinto de hacer algo así:</p>
<pre><code class="language-csharp">var ahora = DateTime.UtcNow; // UTC
var postPublication = new DateTime(2017, 2, 7, 23, 0, 0); // ???
</code></pre>
<p>Si imprimes las dos, podrías ver cosas más o menos idénticas:</p>
<pre><code class="language-csharp">Console.WriteLine(&quot;UTC:\t\t&quot; + ahora.ToString(&quot;o&quot;));
Console.WriteLine(&quot;UTC:\t\t&quot; + now);
</code></pre>
<pre><code class="language-csharp">UTC:		2017-02-06T22:58:27.6325390Z
UTC:		2017-02-06T22:58:27Z
</code></pre>
<p>Pero ya veremos más adelante que si hay diferencia.</p>
<h2 id="zoneddatetime-y-datetimezoneproviders">ZonedDateTime y DateTimeZoneProviders</h2>
<p>Ya que tenemos el tiempo actual en <code>ahora</code> y <code>now</code> vamos a convertirlo al tiempo de la computadora local. Usando el tradicional <code>DateTime</code> no es tan complicado:</p>
<pre><code class="language-csharp">var ahoraLocal = ahora.ToLocalTime(); // Hora local
Console.WriteLine(&quot;Hora local:\t&quot; + ahoraLocal.ToString(&quot;o&quot;));
</code></pre>
<p>Dará como resultado  <code>Hora local:	2017-02-06T16:58:27.6325390-06:00</code></p>
<p>Ahora, como vimos antes, un <code>Instant</code> es un moment en el tiempo. Por si mismo un momento en el tiempo no tiene mucho sentido, al menos para los humanos, para nosotros es necesario darle un contexto, como el de una zona horaria, para poder entenderlo de mejor manera. Y es aquí cuando entra en juego la estructura <code>ZonedDateTime</code> que nos ayuda a darle este contexto a cada momento. Entonces se requiere un par de pasos extra que nos forzarán a pensar un poco más sobre los tiempos y el contexto de los datos:</p>
<ul>
<li>El primer paso es obtener una zona horaria (<code>DateTimeZone</code>) de un proveedor (<code>DateTimeZoneProviders</code>), la librería tiene por default dos proveedores: <code>Bcl</code> y <code>Tzdb</code>, para fines prácticos diremos que la primera son las zonas horarias del sistema y la segunda son las zonas horarias definidas por la (Internet Assigned Numbers Authority) IANA. <strong>Procura siempre usar el proveedor de IANA</strong>:</li>
</ul>
<pre><code class="language-csharp">// Obtenemos la zona horaria local del proveedor Bcl (sistema)
DateTimeZone localTimeZone = DateTimeZoneProviders.Bcl.GetSystemDefault(); 
</code></pre>
<ul>
<li>El segundo paso es simplemente convertir nuestro <em>momento UTC</em> <code>now</code> a la zona horaria mediante el método <code>InZone</code>:</li>
</ul>
<pre><code class="language-csharp">// Conversión a la zona horaria local
ZonedDateTime localNow = now.InZone(localTimeZone);
Console.WriteLine(&quot;Hora local:\t&quot; + localNow);
</code></pre>
<p>¿Por qué tiene todo que ser tan complicado? ¿no es más sencillo usar solo <code>DateTime</code>? la respuesta es... no, al menos si quieres una aplicación que funcione y muestre tiempos correctos sin importar el huso horario en el que esté funcionando. La complicación con <code>DateTime</code> aparece cuando queremos convertir el momento a una hora local.</p>
<p>Por ejemplo, si quisiera saber la hora local en que fue publicado este post en la Ciudad de México y Copenhagen tendría que hacer algo más o menos así:</p>
<ul>
<li>Usando <code>DateTime</code>. Bah, muy fácil, si ya tengo el tiempo en UTC bastaría con sumarle o restarle las horas correspondientes para obtener las horas locales:</li>
</ul>
<pre><code class="language-csharp">// Normalmente la Ciudad de México está en -6... ¿o en horario de verano -5?
DateTime mexicoAhora = postPublication.AddHours(-6);
Console.WriteLine(&quot;Mexico City:\t&quot; + mexicoAhora.ToString(&quot;o&quot;));

// Normalmente la Copenhagen está en +1... ¿o en horario de verano +2?
DateTime copenhagenAhora = postPublication.AddHours(1);
Console.WriteLine(&quot;Copenhagen:\t&quot; + copenhagenAhora.ToString(&quot;o&quot;)

// Imprimirá
// Mexico City:	2017-02-07T17:00:00.0000000
// Copenhagen:	2017-02-08T00:00:00.0000000
</code></pre>
<p>Podría funcionar... en ciertos momentos, ya que el código anterior no toma en cuenta el horario de verano (o <em>Daylight Saving/Summer Time</em>), lo cual significa que tu código funcionaría correctamente una parte del año. Y como viste en el vídeo de un poco más arriba, la cosa se puede poner más complicada.</p>
<ul>
<li><strong>NodaTime</strong> al rescate. Aquí cobra vital importancia esta pequeña librería ya que nos permite hacer estas conversiones sin preocuparnos sobre zonas horarias, horarios de verano y demás. Basta con obtener una zona horaria de un proveedor (usaremos el proveedor de IANA) y realizar la conversión:</li>
</ul>
<pre><code class="language-csharp">DateTimeZone mexicoTimeZone = DateTimeZoneProviders.Tzdb[&quot;America/Mexico_City&quot;];
ZonedDateTime mexicoNow = publicacionPost.InZone(mexicoTimeZone);
Console.WriteLine(&quot;Mexico City:\t&quot; + mexicoNow);

DateTimeZone copenhagenTimeZone = DateTimeZoneProviders.Tzdb[&quot;Europe/Copenhagen&quot;];
ZonedDateTime copenhagenNow = publicacionPost.InZone(copenhagenTimeZone);
Console.WriteLine(&quot;Copenhagen:\t&quot; + copenhagenNow);

// Imprimirá  
// Mexico City:	2017-02-07T17:00:00 America/Mexico_City (-06)
// Copenhagen:	2017-02-08T00:00:00 Europe/Copenhagen (+01)
</code></pre>
<p>Pareciera más complicado... pero a la larga resulta más mantenible y entendible. Como puedes ver se hace referencia clara a qué zona horaria queremos transformar nuestro <em>momento</em>, no tenemos que estar adivinando qué significa ese <code>-6</code> o ese <code>1</code> en nuestro código. Como referencia, puedes visitar estos enlaces para obtener los nombres de cada zona horaria: <a href="https://www.iana.org/time-zones" target="_blank">IANA time zone database</a> y <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" target="_blank">List of tz database time zones</a>.</p>
<h3 id="localdate-y-localtime">LocalDate y LocalTime</h3>
<p>NodaTime también nos facilita el manejo de datos cuando debemos manejar solo fechas u horas en un día, sin necesidad de preocuparnos por eliminar las componentes de tiempo o fecha nosotros mismos. Esto lo hace a través de las estructuras <code>LocalDate</code> y <code>LocalTime</code></p>
<h3 id="period-duration-e-interval">Period, Duration e Interval</h3>
<p>NodaTime también incluye estructuras para trabajar con periodos de tiempo, duraciones e intervalos. Algo muy parecido a lo que se puede hacer con <code>TimeSpan</code> pero dándole un poco más de contexto para hacer más entendible el código de nuestra aplicación.</p>
<h2 id="ejemplo-de-uso-e-instalacion">Ejemplo de uso e instalación</h2>
<p>Como siempre, la mejor forma de aprender a manejar algo es experimentando con él, así que no te olvides de <a href="https://github.com/ThatCSharpGuy/NodaTime-Sample" target="_blank">descargar el código fuente</a>.</p>
<p>Para instalarlo puedes usar NuGet, ya sea la interfaz gráfica o el administrador de paquetes:</p>
<pre><code>PM&gt; Install-Package NodaTime
</code></pre>
<p>Y como casi siempre con estos #NuGetsRecomendados puedes descargar el <a href="https://github.com/nodatime/nodatime" target="_blank">código fuente</a> de la librería y hasta contribuír a su desarrollo.</p>


    </div>
</article>

                    </section>
                    <section class="sidebar">
                        <div class="theme-toggle">
  <input type="checkbox" id="theme-switch"/>
  <label for="theme-switch">
      <div class="toggle"></div>
      <div class="names">
          <p class="light">Light</p>
          <p class="dark">Dark</p>
      </div>
  </label>
</div>
  


<script>
    (function() {
      var sw = document.getElementById('theme-switch');
      var html = document.getElementsByTagName('html')[0];
      var nightModeOption = ('auto' || 'auto').toLowerCase();
      var storage = nightModeOption === 'manual'
          ? localStorage
          : sessionStorage;
      var themeData = loadThemeData();
  
      function saveThemeData(data) {
        storage.setItem('theme', JSON.stringify(data));
      }
  
      function loadThemeData() {
        var data = storage.getItem('theme');
        try {
          data = JSON.parse(data ? data : '');
        } catch(e) {
          data = { nightShift: undefined, autoToggleAt: 0 };
          saveThemeData(data);
        }
        return data;
      }
  
      function handleThemeToggle(nightShift) {
        themeData.nightShift = nightShift;
        saveThemeData(themeData);
        html.dataset.theme = nightShift ? 'dark' : 'light';
        setTimeout(function() {
          sw.checked = nightShift ? true : false;
        }, 50);
      }
  
      function autoThemeToggle() {
        // Next time point of theme toggle
        var now = new Date();
        var toggleAt = new Date();
        var hours = now.getHours();
        var nightShift = hours >= 19 || hours <=7;
  
        if (nightShift) {
          if (hours > 7) {
            toggleAt.setDate(toggleAt.getDate() + 1);
          }
          toggleAt.setHours(7);
        } else {
          toggleAt.setHours(19);
        }
  
        toggleAt.setMinutes(0);
        toggleAt.setSeconds(0);
        toggleAt.setMilliseconds(0)
  
        var delay = toggleAt.getTime() - now.getTime();
  
        // auto toggle theme mode
        setTimeout(function() {
          handleThemeToggle(!nightShift);
        }, delay);
  
        return {
          nightShift: nightShift,
          toggleAt: toggleAt.getTime()
        };
      }
  
      // Listen the theme toggle event
      sw.addEventListener('change', function(event) {
        handleThemeToggle(event.target.checked);
      });
  
      if (nightModeOption == 'auto') {
        var data = autoThemeToggle();
  
        // Toggle theme by local setting
        if (data.toggleAt > themeData.autoToggleAt) {
          themeData.autoToggleAt = data.toggleAt;
          handleThemeToggle(data.nightShift);
        } else {
          handleThemeToggle(themeData.nightShift);
        }
      } else if (nightModeOption == 'manual') {
        handleThemeToggle(themeData.nightShift);
      } else {
        var nightShift = themeData.nightShift;
        if (nightShift === undefined) {
          nightShift = nightModeOption === 'on';
        }
        handleThemeToggle(nightShift);
      }
    })();
  </script>
                        <div class="post-menu">
                            <div class="post-menu-title">Sígueme en</div>
                            <div class="common-list">
                                <ul>
                                    
                                    <li>
                                        <a href="https://github.com/fferegrino">GitHub<span><i class="fab fa-github"></i></span></a>
                                    </li>
                                    
                                    <li>
                                        <a href="https://twitter.com/io_exception">Twitter<span><i class="fab fa-twitter"></i></span></a>
                                    </li>
                                    
                                    <li>
                                        <a href="https://youtube.com/thatcsharpguy">YouTube<span><i class="fab fa-youtube"></i></span></a>
                                    </li>
                                    
                                    <li>
                                        <a href="https://tcsg.dev/discord">Discord<span><i class="fab fa-discord"></i></span></a>
                                    </li>
                                    
                                </ul>
                            </div>
                        </div>
                        
 <style type="text/css" media="screen">
    .post-menu ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
</style>
<div class="post-menu toc">
    <div class="post-menu-title">TOC</div>
    <div class="post-menu-content"></div>
</div>
<script>
    function generateContent() {
        var menu = document.querySelector(".post-menu.toc");
        console.log(menu);
        var menuContent = menu.querySelector(".post-menu-content");
        var headings = document.querySelector(".post-content").querySelectorAll("h2, h3, h4, h5, h6");
        // Hide menu when no headings
        if (headings.length === 0) {
            return menu.style.display = "none";
        }
        // Generate post menu
        var menuHTML = '';
        for (var i = 0; i < headings.length; i++) {
            var h = headings[i];
            menuHTML += ('<li class="h-' + h.tagName.toLowerCase() + '">' + '<a href="#' + h.getAttribute('id') + '">' + h.textContent + '</a></li>');
        }
        menuContent.innerHTML = '<ul>' + menuHTML + '</ul>';
        // The header element
        var header = document.querySelector('header.site-header');
        function doMenuCollapse(index, over_items) {
            var items = menuContent.firstChild.children;
            if (over_items == undefined) {
                over_items = 20;
            }
            if (items.length<over_items) {
        return;
      }

      var activeItem = items[index];
      var beginItem = activeItem
      var endItem = activeItem
      var beginIndex = index;
      var endIndex = index + 1;
      while (beginIndex >= 0 && ! items[beginIndex].classList.contains('h-h2')) {
                beginIndex -= 1;
            }
            while (endIndex < items.length && ! items[endIndex].classList.contains('h-h2')) {
                endIndex += 1;
            }
            for (var i = 0; i < beginIndex; i++) {
                item = items[i]
                if (!item.classList.contains('h-h2')) {
                    item.style.display = 'none';
                }
            }
            for (var i = beginIndex + 1; i < endIndex; i++) {
                item = items[i]
                // if (!item.classList.contains('h-h2')) {
                item.style.display = '';
                // }
            }
            for (var i = endIndex; i < items.length; i++) {
                item = items[i]
                if (!item.classList.contains('h-h2')) {
                    item.style.display = 'none';
                }
            }
        }
        // Init menu collapsed
        doMenuCollapse(-1);
        // Active the menu item
        window.addEventListener('scroll', function (event) {
            var lastActive = menuContent.querySelector('.active');
            var changed = true;
            var activeIndex = -1;
            for (var i = headings.length - 1; i >= 0; i--) {
                var h = headings[i];
                var headingRect = h.getBoundingClientRect();
                var headerRect = header.getBoundingClientRect();
                var headerTop = Math.floor(headerRect.top);
                var headerHeight = Math.floor(headerRect.height);
                var headerHeight = headerTop + headerHeight + 20;
                if (headingRect.top <= headerHeight) {
                    var id = 'h-' + h.getAttribute('id');
                    var a = menuContent.querySelector('a[href="#' + id + '"]');
                    var curActive = a.parentNode;
                    if (curActive) {
                        curActive.classList.add('active');
                        activeIndex = i;
                    }
                    if (lastActive == curActive) {
                        changed = false;
                    }
                    break;
                }
            }
            if (changed) {
                if (lastActive) {
                    lastActive.classList.remove('active');
                }
                doMenuCollapse(activeIndex);
            }
            event.preventDefault();
        });
    }
    document.addEventListener("DOMContentLoaded", function() {
        generateContent()
    });
</script>

                    </section>
                </div>
            </div>
        </div>
        <footer class="site-footer h-card">
   <data class="u-url" href="/"></data>
 
   <div class="wrapper">
     <div class="site-footer-inner">
       <div> </div>
       <div>Powered by <a title="Lockdonw in a simple, blog-aware, static site generator." href="https://github.com/lockdownblog/lockdown">Lockdown</a> &amp; <a title="Yat, yetanother theme." href="https://github.com/jeffreytse/jekyll-theme-yat">Yat Theme</a>.</div>
       <!-- <div class="footer-col rss-subscribe">Subscribe <a href="/feed.xml">via RSS</a></div> -->
     </div>
   </div>
 </footer>
    </body>
</html>