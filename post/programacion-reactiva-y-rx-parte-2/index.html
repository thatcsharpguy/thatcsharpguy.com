<!DOCTYPE html>
<html lang="es" itemscope itemtype="http://schema.org/Blog">
    <head>
        <!–– Made with Lockdown: https://github.com/fferegrino/lockdown ––>
  
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-translate-customization" content="108d9124921d80c3-80e20d618ff053c8-g4f02ec6f3dba68b7-c"></meta>

  <link rel="shortcut icon" href="">
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
  <script src="https://kit.fontawesome.com/0271495296.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-noto-sans@0.0.72/index.min.css">
  <link rel="stylesheet" href="/css/main.css">
  <script src="/js/main.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/vs.min.css" integrity="sha512-aWjgJTbdG4imzxTxistV5TVNffcYGtIQQm2NBNahV6LmX14Xq9WwZTL1wPjaSglUuVzYgwrq+0EuI4+vKvQHHw==" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js" integrity="sha512-9GIHU4rPKUMvNOHFOer5Zm2zHnZOjayOO3lZpokhhCtgt8FNlNiW/bb7kl0R5ZXfCDVPcQ8S4oBdNs92p5Nm2w==" crossorigin="anonymous"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script data-ad-client="ca-pub-9566151416325480" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#2176ff">
<meta name="msapplication-TileColor" content="#eeeef2">
<meta name="theme-color" content="#eeeef2">


  <title>Programación reactiva y Rx, parte 2 | That C# guy</title>

  <!-- Search Engine -->
  <meta name="description" content="La programación reactiva es una de las formas de implementar el patrón del observador en nuestro código, y las Reactive Extensions hacen esta tarea mucho más sencilla.">
  <meta name="image" content="">
  <!-- Schema.org for Google -->
  <meta itemprop="name" content="Programación reactiva y Rx, parte 2">
  <meta itemprop="description" content="La programación reactiva es una de las formas de implementar el patrón del observador en nuestro código, y las Reactive Extensions hacen esta tarea mucho más sencilla.">
  <meta itemprop="image" content="">
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Programación reactiva y Rx, parte 2">
  <meta name="twitter:description" content="La programación reactiva es una de las formas de implementar el patrón del observador en nuestro código, y las Reactive Extensions hacen esta tarea mucho más sencilla.">
  <meta name="twitter:site" content="@io_exception">
  <meta name="twitter:creator" content="@io_exception">
  <meta name="twitter:image" content="">
  <!-- Open Graph general (Facebook, Pinterest & Google+) -->
  <meta name="og:title" content="Programación reactiva y Rx, parte 2">
  <meta name="og:description" content="La programación reactiva es una de las formas de implementar el patrón del observador en nuestro código, y las Reactive Extensions hacen esta tarea mucho más sencilla.">
  <meta name="og:image" content="">
  <meta name="og:url" content="https://thatcsharpguy.com/">
  <meta name="og:site_name" content="That C# guy">
  <meta name="og:locale" content="es">
  <meta name="og:type" content="website">


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GPXCSH21CP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GPXCSH21CP');
</script>

        
    </head>
    <body style="position: relative; min-height: 100%; top: 0px;">
        <header class="site-header " role="banner">
  <div class="wrapper">
     <div class="site-header-inner">
       <span class="site-brand">
         <a class="site-brand-inner" rel="author" href="/">
          <!-- <img class="site-favicon" title="Your awesome title" src="" onerror="this.style.display='none'"> -->
          That C# guy
        </a>
      </span>
        <nav class="site-nav">
           <input type="checkbox" id="nav-trigger" class="nav-trigger">
           <label for="nav-trigger">
              <span class="menu-icon">
                 <svg viewbox="0 0 18 15" width="18px" height="15px">
                    <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
                 </svg>
              </span>
           </label>
           <div class="trigger">
             <!-- Header links -->
              <a class="page-link" target="_blank" href="https://www.youtube.com/thatcsharpguy/">YOUTUBE</a>
              <span class="page-link">
    <div id="google_translate_element" style="display: none;"></div>
    <span class="ct-language">
       <ul class="list-unstyled ct-language-dropdown">
         <li>
            <a href="#" class="lang-select" data-lang="es">
            <img src="https://www.countryflags.io/mx/flat/64.png" title="México">
            </a>
         </li>
          <li>
             <a href="#" class="lang-select" data-lang="en">
             <img src="https://www.countryflags.io/gb/flat/64.png" title="English">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="fr">
             <img src="https://www.countryflags.io/fr/flat/64.png" title="Franch">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="zh-CN">
             <img src="https://www.countryflags.io/cn/flat/64.png" title="Chinese(Simple)">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="ja">
             <img src="https://www.countryflags.io/jp/flat/64.png" title="Japan">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="ko">
             <img src="https://www.countryflags.io/kr/flat/64.png" title="Korean">
             </a>
          </li>
          <li>
             <a href="#" class="lang-select" data-lang="ru">
             <img src="https://www.countryflags.io/ru/flat/64.png" title="Russia">
             </a>
          </li>
       </ul>
    </span>
    <script type="text/javascript">
       function googleTranslateElementInit() {
         new google.translate.TranslateElement({
           pageLanguage: '',
           autoDisplay: false,
           layout: google.translate.TranslateElement.InlineLayout.VERTICAL
         }, 'google_translate_element');
       
         function restoreLang() {
           var iframe = document.getElementsByClassName('goog-te-banner-frame')[0];
           if (!iframe) return;
       
           var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
           var restore_el = innerDoc.getElementsByTagName("button");
       
           for (var i = 0; i < restore_el.length; i++) {
             if (restore_el[i].id.indexOf("restore") >= 0) {
               restore_el[i].click();
               var close_el = innerDoc.getElementsByClassName("goog-close-link");
               close_el[0].click();
               return;
             }
           }
         }
       
         function triggerHtmlEvent(element, eventName) {
           var event;
           if (document.createEvent) {
             event = document.createEvent('HTMLEvents');
             event.initEvent(eventName, true, true);
             element.dispatchEvent(event);
           } else {
             event = document.createEventObject();
             event.eventType = eventName;
             element.fireEvent('on' + event.eventType, event);
           }
         }
       
         var googleCombo = document.querySelector("select.goog-te-combo");
         var langSelect = document.querySelector('.ct-language');
         langSelect.addEventListener('click', function(event) {
           if (!event.target) {
             return;
           }
       
           var selected = document.querySelector('.ct-language .ct-language-selected');
           if (selected) {
             selected.classList.remove('ct-language-selected');
           }
       
           var target = event.target;
           while (target && target !== langSelect ) {
             if (target.matches('.lang-select')) {
               break;
             }
             target = target.parentElement;
           }
       
           if (target && target.matches('.lang-select')) {
             var lang = target.getAttribute('data-lang');
             if (lang == "es") {
               restoreLang();
             } else {
               target.parentElement.classList.add('ct-language-selected');
               googleCombo.value = lang;
               triggerHtmlEvent(googleCombo, 'change');
             }
           }
       
           event.preventDefault();
         });
       }
    </script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
 </span>
           </div>
        </nav>
     </div>
  </div>
</header>
<script>
  (function() {
    var lastScrollY = getScrollPos().y;
    var documentElement = document.documentElement;

    function storeScrollData() {
      var y = getScrollPos().y;

      documentElement.setAttribute("data-header-transparent", "");

      var scrollStatus = "";
      if (y <= 0) {
        scrollStatus = "top";
      } else if ((window.innerHeight + y) >= document.body.offsetHeight) {
        scrollStatus = "bottom";
      } else {
        var isScrollDown = (y - lastScrollY > 0) ? true : false;
        scrollStatus = isScrollDown ? "down" : "up";
      }
      lastScrollY = y;
      documentElement.setAttribute("data-scroll-status", scrollStatus);
    }
    window.addEventListener('scroll', function(e) {
      storeScrollData();
    });
    storeScrollData();
  })();
</script>
        
        <div class="theme-toggle">
  <input type="checkbox" id="theme-switch"/>
  <label for="theme-switch">
      <div class="toggle"></div>
      <div class="names">
          <p class="light">Light</p>
          <p class="dark">Dark</p>
      </div>
  </label>
</div>
  


<script>
    (function() {
      var sw = document.getElementById('theme-switch');
      var html = document.getElementsByTagName('html')[0];
      var nightModeOption = ('auto' || 'auto').toLowerCase();
      var storage = nightModeOption === 'manual'
          ? localStorage
          : sessionStorage;
      var themeData = loadThemeData();
  
      function saveThemeData(data) {
        storage.setItem('theme', JSON.stringify(data));
      }
  
      function loadThemeData() {
        var data = storage.getItem('theme');
        try {
          data = JSON.parse(data ? data : '');
        } catch(e) {
          data = { nightShift: undefined, autoToggleAt: 0 };
          saveThemeData(data);
        }
        return data;
      }
  
      function handleThemeToggle(nightShift) {
        themeData.nightShift = nightShift;
        saveThemeData(themeData);
        html.dataset.theme = nightShift ? 'dark' : 'light';
        setTimeout(function() {
          sw.checked = nightShift ? true : false;
        }, 50);
      }
  
      function autoThemeToggle() {
        // Next time point of theme toggle
        var now = new Date();
        var toggleAt = new Date();
        var hours = now.getHours();
        var nightShift = hours >= 19 || hours <=7;
  
        if (nightShift) {
          if (hours > 7) {
            toggleAt.setDate(toggleAt.getDate() + 1);
          }
          toggleAt.setHours(7);
        } else {
          toggleAt.setHours(19);
        }
  
        toggleAt.setMinutes(0);
        toggleAt.setSeconds(0);
        toggleAt.setMilliseconds(0)
  
        var delay = toggleAt.getTime() - now.getTime();
  
        // auto toggle theme mode
        setTimeout(function() {
          handleThemeToggle(!nightShift);
        }, delay);
  
        return {
          nightShift: nightShift,
          toggleAt: toggleAt.getTime()
        };
      }
  
      // Listen the theme toggle event
      sw.addEventListener('change', function(event) {
        handleThemeToggle(event.target.checked);
      });
  
      if (nightModeOption == 'auto') {
        var data = autoThemeToggle();
  
        // Toggle theme by local setting
        if (data.toggleAt > themeData.autoToggleAt) {
          themeData.autoToggleAt = data.toggleAt;
          handleThemeToggle(data.nightShift);
        } else {
          handleThemeToggle(themeData.nightShift);
        }
      } else if (nightModeOption == 'manual') {
        handleThemeToggle(themeData.nightShift);
      } else {
        var nightShift = themeData.nightShift;
        if (nightShift === undefined) {
          nightShift = nightModeOption === 'on';
        }
        handleThemeToggle(nightShift);
      }
    })();
  </script>
        <div class="page-content">
            <div class="wrapper">
                <div class="framework">
                    <section class="main"> 
                        
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
    <div class="post-content e-content" itemprop="articleBody">
        
<p><a href="..\reactive-extensions-1" target="_blank">En el post pasado</a> les comencé a hablar de las <em>Reactive Extensions</em> y cómo es que introducían un paradigma de programación distinto. Ahí mostré un ejemplo muy sencillo de la programación reactiva... pero sé que no siempre todo el código que escribiremos será así de sencillo, así que en este post crearé y mostraré un caso más complejo en el que podemos utilizar <em>Rx</em>.</p>
<h2 id="el-rio">El río</h2>
<p>Piensa en un río en el cual hay un conjunto de peces que viajan a través de él, es por eso que los pescadores se acercan al río para tratar de conseguir un poco de alimento. El río produce una cantidad <code>x</code> de peces que pasan por él uno a uno cada <code>y</code> milisegundos, además de que hay ocasiones en que el agua del río hace muy peligroso pescar en él.</p>
<h3 id="river"><code>River</code></h3>
<p>Para recrear las condiciones anteriores, crea una clase llamada <code>River</code> que reciba y almacene las especificaciones de la cantidad de peces, el tiempo entre ellos y si es o no peligroso:</p>
<pre><code class="language-csharp">public class River
{
    private readonly int _fishAmount;
    private readonly int _waitTime;
    private readonly bool _dangerousRiver;


    public River(int fishAmount, int waitTime = 500,  bool dangerousRiver = false)
    {
        _fishAmount = fishAmount;
        _waitTime = waitTime;
        _dangerousRiver = dangerousRiver;
    }
</code></pre>
<h3 id="fish"><code>Fish</code></h3>
<p>Pero aguarda, no te olvides de los peces: estos tendrán una especie (<code>FishSpecies</code>), un color (<code>Color</code>) y un peso (<code>Weight</code>), todo representado dentro de una clase:</p>
<pre><code class="language-csharp">    public class Fish
    {
        public double Weight { get; set; }
        public Color Color { get; set; }
        public FishSpecies Species { get; set; }

        #region Random fish

        private static readonly Random R = new Random();
        private const double MinWeight = 500; // Gramos
        private const double MaxWeight = 5000; // Gramos

        public static Fish RandomFish()
        {
            var fish = new Fish
            {
                Weight = (R.NextDouble() * (MaxWeight - MinWeight)) + MinWeight,
                Species = (FishSpecies) R.Next(4), // There are four species
                Color = (Color) R.Next(4) // There are four colors
            };

            return fish;
        }

        #endregion
    }
</code></pre>
<p>Oh, además en esta clase introduje un método para crear peces aleatoriamente.</p>
<h3 id="river-cont"><code>River</code> (cont)</h3>
<p>Bueno, volviendo al diseño del río. Ahora toca escribir la forma en que representaremos el paso de los peces a través de él. ¿Estás de acuerdo en que es un <strong>flujo</strong>? sí, un flujo de peces.  Y al ser un flujo es el un buen candidato para convertirse en un <code>IObservable</code>de <code>Fish</code>.</p>
<p>Para acceder al flujo de peces usaremos un método que retorne un <code>IOBservable&lt;Fish&gt;</code>. Acá es una buena oportunidad para decir que no es recomendable que tu mismo implementes la interfaz, lo mejor en muchos casos es hacer uso de las <em>Reactive Extensions</em> para crear un objeto de ese tipo:</p>
<pre><code class="language-csharp">    public IObservable&lt;Fish&gt; Stream()
    {
        return Observable.Create&lt;Fish&gt;(observer =&gt;
        {
            for (int i = 0; i &lt; _fishAmount; i++)
            {
                var fish = Fish.RandomFish();
                observer.OnNext(fish);
                Thread.Sleep(_waitTime);

                if (_dangerousRiver &amp;&amp; i == _fishAmount / 3)
                    throw new Exception(&quot;Uh, hubo un derrame en el río&quot;);
            }
            observer.OnCompleted();
            return () =&gt; { };
        });
    }
</code></pre>
<p>Vamos a revisar qué es lo que está ocurriendo en ese método:</p>
<dl>
   <dt>1.</dt>
    <dd>Lo primero que nos damos cuenta es el tipo de retorno: <code>IObservable&lt;Fish&gt;</code></dd>
   <dt>2.</dt>
    <dd>Inmediatamente después tenemos la creación de nuestro observable mediante el método estático <code>Observable.Create</code>, este método recibe un `Func&lt;IObserver&lt;Fish&gt;, Action&gt;`. El parámetro de entrada (<code>IObserver&lt;Fish&gt;</code>) es una referencia al suscriptor que está al tanto de lo que publiquemos. El valor de retorno (<code>Action</code>) es un delegado que en teoría deberíamos usar para limpiar los recursos que usamos en el flujo. </dd>
   <dt>3.</dt>
    <dd>Vamos a generar tantos peces como sean necesarios, en este caso creándolos de forma aleatoria, después, publicaremos cada uno de los peces a nuestro <code>Observer</code> mediante su método <code>OnNext</code>.  
    Esperarémos después el tiempo indicado entre cada pez.
    Antes de repetir el ciclo comprobaremos que el río es seguro, y si no lo es, lanzaremos una excepción. </dd>
   <dt>4.</dt>
    <dd>Apenas terminar el ciclo enviaremos el mensaje <code>OnCompleted</code> al <code>observer</code></dd>
   <dt>5.</dt>
    <dd>Regresaremos una <code>Action</code> vacía, recuerda que deberíamos usar este para liberar los recursos que usó nuestro flujo de datos. En este caso, no debemos liberar nada.</dd>
</dl>
<p>Usar el método <code>Observable.Create&lt;T&gt;</code> es solo una de las muchas maneras en las que podemos crear un flujo, <a href="https://weblogs.asp.net/sweinstein/16-ways-to-create-iobservables-without-implementing-iobservable" target="_blank">en este sitio web</a> puedes ver 16 formas de crearlos sin necesidad de heredar tú mismo de <code>IObservable</code>.</p>
<h2 id="usando-el-rio">Usando el río</h2>
<p>Vamos a crear un par de ríos para después poder suscribirnos a ellos:</p>
<pre><code class="language-csharp">var rioNormal = new River(10);
var rioRapido = new River(10, waitTime: 10);
var dangerousRiver = new River(fishAmount: 10, dangerousRiver: true);
</code></pre>
<p>Entonces ahora podemos suscribirnos y estar al tanto de qué peces pasan por el río:</p>
<pre><code class="language-csharp">rioNormal.Stream()
    .Subscribe(
        onNext: fish =&gt; Console.WriteLine($&quot;{DateTime.Now:HH:mm:ss.ffff}: {fish}&quot;),
        onCompleted: () =&gt; Console.WriteLine(&quot;¡Terminé de pescar!&quot;)
    );
</code></pre>
<pre>
13:35:40.3923: Anglerfish, Green, 3,787.68
13:35:40.9770: Anglerfish, Green, 1,462.02
13:35:41.4831: ClownFish, Black, 1,469.41
13:35:41.9871: Blowfish, Red, 1,539.82
13:35:42.4926: Tuna, Black, 2,540.65
13:35:42.9931: Blowfish, Green, 2,905.58
13:35:43.4939: Blowfish, Red, 3,611.61
13:35:43.9994: Tuna, Black, 2,029.88
13:35:44.5048: Tuna, Yellow, 1,672.38
13:35:45.0102: Anglerfish, Black, 4,194.68
¡Terminé de pescar!
</pre>
<p>Como vimos anteriormente, también podemos filtrar los elementos:</p>
<pre><code class="language-csharp">rioNormal.Stream()
    .Where(fish =&gt; fish.Color == Color.Green &amp;&amp; fish.Weight &gt; 3000) // Filtramos los elementos
    .Subscribe(
        onNext: fish =&gt; Console.WriteLine($&quot;{DateTime.Now:HH:mm:ss.ffff}: {fish}&quot;),
        onCompleted: () =&gt; Console.WriteLine(&quot;¡Terminé de pescar!&quot;)
    );
</code></pre>
<pre>
13:35:48.5546: Blowfish, Green, 3,420.28
13:35:50.0690: Anglerfish, Green, 3,974.44
¡Terminé de pescar!
</pre>  
<p>Podemos agrupar los elementos con el método <code>Buffer</code>, que permitirá agrupar los elementos del flujo. Por ejemplo, imagina que el pescador está usando una red para 3 peces:</p>
<pre><code class="language-csharp">rioNormal.Stream()
    .Buffer(3) // Agrupamos 3 elementos
    .Subscribe(
        onNext: fishCollection =&gt;
        {
            var f = String.Join(&quot;, &quot;, fishCollection.Select(fi =&gt; fi.Species));
            Console.WriteLine($&quot;Atrapé {fishCollection.Count} peces ({f})&quot;);
        },
        onCompleted: () =&gt; Console.WriteLine(&quot;¡Terminé de pescar usando una red para 3 peces!&quot;)
    );
</code></pre>
<pre>
Atrapé 3 peces (Tuna, Blowfish, Tuna)
Atrapé 3 peces (Tuna, Tuna, Blowfish)
Atrapé 3 peces (Tuna, Blowfish, Blowfish)
Atrapé 1 peces (Anglerfish)
¡Terminé de pescar usando una red para 3 peces!
</pre>
<p>Y no olvides que podemos especificarle al código que hacer en caso de que ocurra un error en el flujo, esto mediante el método (o lambda en este caso) <code>OnError</code>:</p>
<pre><code class="language-csharp">dangerousRiver.Stream()
    .Subscribe(
        onNext: fish =&gt; Console.WriteLine($&quot;{DateTime.Now:HH:mm:ss.ffff}: {fish}&quot;),
        onError: ex =&gt; Console.WriteLine($&quot;Ocurrió un problema en el río: {ex.Message}&quot;),
        onCompleted: () =&gt; Console.WriteLine(&quot;¡Terminé de pescar en el río peligroso!&quot;)
    );
</code></pre>
<pre>
13:35:45.5200: Anglerfish, Black, 3,171.37
13:35:46.0216: Anglerfish, Red, 3,041.97
13:35:46.5272: Anglerfish, Black, 4,589.28
13:35:47.0297: Blowfish, Black, 3,128.05
Ocurrió un problema en el río: Uh, hubo un derrame en el río
</pre>
<h2 id="el-pescador-o-iobserverfish">El pescador o <code>IObserver&lt;Fish&gt;</code></h2>
<p>Hasta el momento hemos estado empleando lambdas para reaccionar a los mensajes de un publicador. Pero si recuerdas, en el post pasado hablé de otra interfaz que representaba al observador, recordarás también que esta interfaz especifica tres métodos. Nosotros vamos a crear una clase <code>Fisher</code> que representará al pescador:</p>
<pre><code class="language-csharp">public class Fisher : IObserver&lt;Fish&gt;
{
    private readonly string _name;

    public Fisher(string name)
    {
        _name = name;
    }
    public void OnNext(Fish value)
    {
        Console.WriteLine($&quot;{_name}: atrapé un {value.Species} de color {value.Color} a las {DateTime.Now:HH:mm:ss.ffff}&quot;);
    }

    public void OnError(Exception error)
    {
        Console.WriteLine($&quot;{_name}: Oops, algo pasó {error.Message}&quot;);
    }

    public void OnCompleted()
    {
        Console.WriteLine($&quot;{_name}: ¡Terminó la pesca!&quot;);
    }
}
</code></pre>
<p>Y una vez que tenemos a un pescador (observador) podemos suscribirlo al flujo de peces para que esté al tanto de lo que ocurre:</p>
<pre><code class="language-csharp">var erik = new Fisher(&quot;Erik&quot;);
rioNormal.Stream()
    .Subscribe(erik);
</code></pre>
<pre>
Erik: atrapé un Anglerfish de color Red a las 13:35:57.6664
Erik: atrapé un Blowfish de color Yellow a las 13:35:57.6795
Erik: atrapé un Anglerfish de color Black a las 13:35:57.6923
Erik: atrapé un Blowfish de color Green a las 13:35:57.7051
Erik: atrapé un Anglerfish de color Red a las 13:35:57.7172
Erik: atrapé un Tuna de color Yellow a las 13:35:57.7301
Erik: atrapé un ClownFish de color Yellow a las 13:35:57.7429
Erik: atrapé un Blowfish de color Yellow a las 13:35:57.7558
Erik: atrapé un ClownFish de color Green a las 13:35:57.7686
Erik: atrapé un Blowfish de color Red a las 13:35:57.7815
Erik: ¡Terminó la pesca!
</pre>
<p>Y listo, ese fue todo el ejemplo. Recuerda que el <a href=" https://github.com/ThatCSharpGuy/rx" target="_blank">código está en GitHub</a> para qe lo descargues y juegues con él. En el futuro estaré creando otro par de ejemplos sobre las bondades de la programación reactiva, entre tanto, si tienes preguntas, no dudes en hacérmelas llegar.</p>


    </div>
</article>

                    </section>
                    <section class="sidebar">
                        <div class="theme-toggle">
  <input type="checkbox" id="theme-switch"/>
  <label for="theme-switch">
      <div class="toggle"></div>
      <div class="names">
          <p class="light">Light</p>
          <p class="dark">Dark</p>
      </div>
  </label>
</div>
  


<script>
    (function() {
      var sw = document.getElementById('theme-switch');
      var html = document.getElementsByTagName('html')[0];
      var nightModeOption = ('auto' || 'auto').toLowerCase();
      var storage = nightModeOption === 'manual'
          ? localStorage
          : sessionStorage;
      var themeData = loadThemeData();
  
      function saveThemeData(data) {
        storage.setItem('theme', JSON.stringify(data));
      }
  
      function loadThemeData() {
        var data = storage.getItem('theme');
        try {
          data = JSON.parse(data ? data : '');
        } catch(e) {
          data = { nightShift: undefined, autoToggleAt: 0 };
          saveThemeData(data);
        }
        return data;
      }
  
      function handleThemeToggle(nightShift) {
        themeData.nightShift = nightShift;
        saveThemeData(themeData);
        html.dataset.theme = nightShift ? 'dark' : 'light';
        setTimeout(function() {
          sw.checked = nightShift ? true : false;
        }, 50);
      }
  
      function autoThemeToggle() {
        // Next time point of theme toggle
        var now = new Date();
        var toggleAt = new Date();
        var hours = now.getHours();
        var nightShift = hours >= 19 || hours <=7;
  
        if (nightShift) {
          if (hours > 7) {
            toggleAt.setDate(toggleAt.getDate() + 1);
          }
          toggleAt.setHours(7);
        } else {
          toggleAt.setHours(19);
        }
  
        toggleAt.setMinutes(0);
        toggleAt.setSeconds(0);
        toggleAt.setMilliseconds(0)
  
        var delay = toggleAt.getTime() - now.getTime();
  
        // auto toggle theme mode
        setTimeout(function() {
          handleThemeToggle(!nightShift);
        }, delay);
  
        return {
          nightShift: nightShift,
          toggleAt: toggleAt.getTime()
        };
      }
  
      // Listen the theme toggle event
      sw.addEventListener('change', function(event) {
        handleThemeToggle(event.target.checked);
      });
  
      if (nightModeOption == 'auto') {
        var data = autoThemeToggle();
  
        // Toggle theme by local setting
        if (data.toggleAt > themeData.autoToggleAt) {
          themeData.autoToggleAt = data.toggleAt;
          handleThemeToggle(data.nightShift);
        } else {
          handleThemeToggle(themeData.nightShift);
        }
      } else if (nightModeOption == 'manual') {
        handleThemeToggle(themeData.nightShift);
      } else {
        var nightShift = themeData.nightShift;
        if (nightShift === undefined) {
          nightShift = nightModeOption === 'on';
        }
        handleThemeToggle(nightShift);
      }
    })();
  </script>
                        <div class="post-menu">
                            <div class="post-menu-title">Sígueme en</div>
                            <div class="common-list">
                                <ul>
                                    
                                    <li>
                                        <a href="https://github.com/fferegrino">GitHub<span><i class="fab fa-github"></i></span></a>
                                    </li>
                                    
                                    <li>
                                        <a href="https://twitter.com/io_exception">Twitter<span><i class="fab fa-twitter"></i></span></a>
                                    </li>
                                    
                                    <li>
                                        <a href="https://youtube.com/thatcsharpguy">YouTube<span><i class="fab fa-youtube"></i></span></a>
                                    </li>
                                    
                                    <li>
                                        <a href="https://tcsg.dev/discord">Discord<span><i class="fab fa-discord"></i></span></a>
                                    </li>
                                    
                                </ul>
                            </div>
                        </div>
                        
 <style type="text/css" media="screen">
    .post-menu ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
</style>
<div class="post-menu toc">
    <div class="post-menu-title">TOC</div>
    <div class="post-menu-content"></div>
</div>
<script>
    function generateContent() {
        var menu = document.querySelector(".post-menu.toc");
        console.log(menu);
        var menuContent = menu.querySelector(".post-menu-content");
        var headings = document.querySelector(".post-content").querySelectorAll("h2, h3, h4, h5, h6");
        // Hide menu when no headings
        if (headings.length === 0) {
            return menu.style.display = "none";
        }
        // Generate post menu
        var menuHTML = '';
        for (var i = 0; i < headings.length; i++) {
            var h = headings[i];
            menuHTML += ('<li class="h-' + h.tagName.toLowerCase() + '">' + '<a href="#' + h.getAttribute('id') + '">' + h.textContent + '</a></li>');
        }
        menuContent.innerHTML = '<ul>' + menuHTML + '</ul>';
        // The header element
        var header = document.querySelector('header.site-header');
        function doMenuCollapse(index, over_items) {
            var items = menuContent.firstChild.children;
            if (over_items == undefined) {
                over_items = 20;
            }
            if (items.length<over_items) {
        return;
      }

      var activeItem = items[index];
      var beginItem = activeItem
      var endItem = activeItem
      var beginIndex = index;
      var endIndex = index + 1;
      while (beginIndex >= 0 && ! items[beginIndex].classList.contains('h-h2')) {
                beginIndex -= 1;
            }
            while (endIndex < items.length && ! items[endIndex].classList.contains('h-h2')) {
                endIndex += 1;
            }
            for (var i = 0; i < beginIndex; i++) {
                item = items[i]
                if (!item.classList.contains('h-h2')) {
                    item.style.display = 'none';
                }
            }
            for (var i = beginIndex + 1; i < endIndex; i++) {
                item = items[i]
                // if (!item.classList.contains('h-h2')) {
                item.style.display = '';
                // }
            }
            for (var i = endIndex; i < items.length; i++) {
                item = items[i]
                if (!item.classList.contains('h-h2')) {
                    item.style.display = 'none';
                }
            }
        }
        // Init menu collapsed
        doMenuCollapse(-1);
        // Active the menu item
        window.addEventListener('scroll', function (event) {
            var lastActive = menuContent.querySelector('.active');
            var changed = true;
            var activeIndex = -1;
            for (var i = headings.length - 1; i >= 0; i--) {
                var h = headings[i];
                var headingRect = h.getBoundingClientRect();
                var headerRect = header.getBoundingClientRect();
                var headerTop = Math.floor(headerRect.top);
                var headerHeight = Math.floor(headerRect.height);
                var headerHeight = headerTop + headerHeight + 20;
                if (headingRect.top <= headerHeight) {
                    var id = 'h-' + h.getAttribute('id');
                    var a = menuContent.querySelector('a[href="#' + id + '"]');
                    var curActive = a.parentNode;
                    if (curActive) {
                        curActive.classList.add('active');
                        activeIndex = i;
                    }
                    if (lastActive == curActive) {
                        changed = false;
                    }
                    break;
                }
            }
            if (changed) {
                if (lastActive) {
                    lastActive.classList.remove('active');
                }
                doMenuCollapse(activeIndex);
            }
            event.preventDefault();
        });
    }
    document.addEventListener("DOMContentLoaded", function() {
        generateContent()
    });
</script>

                    </section>
                </div>
            </div>
        </div>
        <footer class="site-footer h-card">
   <data class="u-url" href="/"></data>
 
   <div class="wrapper">
     <div class="site-footer-inner">
       <div> </div>
       <div>Powered by <a title="Lockdonw in a simple, blog-aware, static site generator." href="https://github.com/lockdownblog/lockdown">Lockdown</a> &amp; <a title="Yat, yetanother theme." href="https://github.com/jeffreytse/jekyll-theme-yat">Yat Theme</a>.</div>
       <!-- <div class="footer-col rss-subscribe">Subscribe <a href="/feed.xml">via RSS</a></div> -->
     </div>
   </div>
 </footer>
    </body>
</html>