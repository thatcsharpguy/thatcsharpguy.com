<!DOCTYPE html>
<html lang="es"  itemscope itemtype="http://schema.org/Blog">
<head>
        <!‚Äì‚Äì Made with Lockdown: https://github.com/fferegrino/lockdown ‚Äì‚Äì>
<meta charset="utf-8" />
<link rel="stylesheet" href="/css/main.css" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/vs.min.css" integrity="sha512-aWjgJTbdG4imzxTxistV5TVNffcYGtIQQm2NBNahV6LmX14Xq9WwZTL1wPjaSglUuVzYgwrq+0EuI4+vKvQHHw==" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js" integrity="sha512-9GIHU4rPKUMvNOHFOer5Zm2zHnZOjayOO3lZpokhhCtgt8FNlNiW/bb7kl0R5ZXfCDVPcQ8S4oBdNs92p5Nm2w==" crossorigin="anonymous"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script data-ad-client="ca-pub-9566151416325480" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="theme-color" content="#ffffff">


<title>Publicando aplicaciones hechas con Xamarin desde GitHub Actions | That C# guy</title>
<!-- Search Engine -->
<meta name="description" content="Aplica la integraci√≥n continua a tus aplicaciones hechas con Xamarin y publica desde GitHub Actions.">
<meta name="image" content="https://i.imgur.com/zGD1Caj.png">
<!-- Schema.org for Google -->
<meta itemprop="name" content="Publicando aplicaciones hechas con Xamarin desde GitHub Actions">
<meta itemprop="description" content="Aplica la integraci√≥n continua a tus aplicaciones hechas con Xamarin y publica desde GitHub Actions.">
<meta itemprop="image" content="https://i.imgur.com/zGD1Caj.png">
<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Publicando aplicaciones hechas con Xamarin desde GitHub Actions">
<meta name="twitter:description" content="Aplica la integraci√≥n continua a tus aplicaciones hechas con Xamarin y publica desde GitHub Actions.">
<meta name="twitter:site" content="@io_exception">
<meta name="twitter:creator" content="@io_exception">
<meta name="twitter:image" content="https://i.imgur.com/zGD1Caj.png">
<!-- Open Graph general (Facebook, Pinterest & Google+) -->
<meta name="og:title" content="Publicando aplicaciones hechas con Xamarin desde GitHub Actions">
<meta name="og:description" content="Aplica la integraci√≥n continua a tus aplicaciones hechas con Xamarin y publica desde GitHub Actions.">
<meta name="og:image" content="https://i.imgur.com/zGD1Caj.png">
<meta name="og:url" content="https://thatcsharpguy.com/posts/2020-07-25-publicando-xamarin-github-actions.html">
<meta name="og:site_name" content="That C# guy">
<meta name="og:locale" content="es">
<meta name="og:type" content="website">


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GPXCSH21CP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-GPXCSH21CP');
</script>

        
</head>

<body>  
        <header class="site-header ui">
    <div class="wrapper menu">
      <nav class="site-nav">
        <a href="#" class="menu-icon">
          <svg viewBox="0 0 18 15">
            <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
            <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
            <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
          </svg>
        </a>
        <div class="trigger">
          <a class="link page-link" href="/">Inicio</a>
          <!-- <a class="link page-link" href="/">Sobre mi</a> -->
          <a class="link page-link youtube" href="/">YouTube</a>
          <a class="link page-link book-reviews" href="/tags/book-review.html">Rese√±as</a>
          <!-- <a class="link page-link gear" href="/">Herramientas</a> -->
          <!-- <a class="link page-link" href="/about">About</a> -->
          <!-- <a class="link page-link" href="/search">Search</a> -->
        </div>
      </nav>
    </div>
    <div class="wrapper title">
      <div class="pure-g">
        <div class="pure-u-1-24 title-number"><span>1</span></div>
        <div class="pure-u-11-24 content-window">
          <a class="site-title" href="/">That C# guy</a>
        </div>
      </div>
  
  </header>
        <div class="page-content">
            <div class="wrapper">
                
<h1>Publicando aplicaciones hechas con Xamarin desde GitHub Actions</h1>

<p>La combinaci√≥n de integraci√≥n y despliegue continuo es fant√°stica, no hay nada mejor que la sensaci√≥n de saber que tus cambios estar√°n en producci√≥n tan r√°pido como sea posible; adem√°s de evitarte el tedio de tener que hacer el <em>deployment</em> manualmente, que en el caso de Xamarin.Forms es un doble dolor: publicar en la App Store y Google Play.</p>
<p>En este peque√±o tutorial les voy a mostrar c√≥mo es que podemos usar las herramientas a nuestro alcance para lograr simplificar el proceso de publicaci√≥n de apps usando GitHub Actions; ahora, mientras que aqu√≠ hablo sobre Actions en espec√≠fico, esto no implica que puedas llevar las mismas ideas a tu herramienta favorita de <em>CI</em>.</p>
<h3 id="requerimientos">Requerimientos</h3>
<p>Vamos a usar <em>GPG</em> para proteger los archivos necesarios para publicar, si no tienes <code>gpg</code> instalada en tu Mac, la puedes instalar con <code> brew install gpg</code>. Idealmente cuentas con una Mac, sin embargo, no te preocupes si ese no es el caso, puedes continuar leyendo el tutorial y aplicar las ideas en tu computadora Windows.</p>
<p>Una contrase√±a (vamos a llamarla <code>DECRYPT_KEY</code>) para encriptar archivos mediante <em>gpg</em>, te recomiendo que sea generada autom√°ticamente. Gen√©rala y tenla a la mano porque la vamos a utilizar unas cuantas veces en este post.</p>
<p>Idealmente ya cuentas con conocimiento de c√≥mo publicar tus apps en las tiendas.</p>
<h1 id="ios">iOS</h1>
<h2 id="obteniendo-un-certificado-de-publicacion-para-ios">Obteniendo un certificado de publicaci√≥n para iOS</h2>
<p>Te recomiendo generar un certificado de publicaci√≥n para cada app que desarrolles, aunque, este certificado lo puedes compartir entre varias, puesto que este certificado te identifica a ti como quien publica la app. En este caso, ser√° el servidor de GitHub el que publique y al que t√∫ le estar√°s dando permiso de autenticarse como tu.</p>
<ul>
<li>Para generar un certificado nuevo, visita <a href="https://developer.apple.com/account/resources/certificates/list">https://developer.apple.com/account/resources/certificates/list</a>, elige &quot;Crear un nuevo certificado&quot; y selecciona &quot;Apple Distribution&quot;:</li>
</ul>
<p><img src="https://imgur.com/b6T6YYw.png" alt="elige &quot;Crear un nuevo certificado&quot; y selecciona &quot;Apple Distribution&quot;" /></p>
<ul>
<li>Una vez creado, descarga el certificado e inst√°lalo en tu computadora. Para instalarlo simplemente da doble click en el archivo que acabas de descargar.</li>
</ul>
<p><img src="https://i.imgur.com/XXThK37.png" alt="descarga el certificado e inst√°lalo en tu computadora" /></p>
<ul>
<li>El siguiente paso es crear y descargar un perfil de publicaci√≥n para tu app:</li>
</ul>
<p><img src="https://i.imgur.com/6CodfmN.png" alt="El siguiente paso es crear y descargar un perfil de publicaci√≥n para tu app" /></p>
<ul>
<li>Elige &quot;Distribution&quot; y &quot;App Store&quot;:</li>
</ul>
<p><img src="https://i.imgur.com/TbrqVrY.png" alt="Elige &quot;Distribution&quot; y &quot;App Store&quot;" /></p>
<ul>
<li>Elige despu√©s el identificador de tu aplicaci√≥n:</li>
</ul>
<p><img src="https://i.imgur.com/0eCLTi0.png" alt="Elige despu√©s el identificador de tu aplicaci√≥n" /></p>
<ul>
<li>Aseg√∫rate tambi√©n que elijas el certificado adecuado, justamente el que creamos en el paso anterior.</li>
</ul>
<p><img src="https://i.imgur.com/pIKkXbl.png" alt="Aseg√∫rate tambi√©n que elijas el certificado adecuado" /></p>
<ul>
<li>Establece un nombre descriptivo, y genera el perfil de publicaci√≥n.</li>
</ul>
<p><img src="https://i.imgur.com/peJlpOZ.png" alt="Establece un nombre descriptivo, y genera el perfil de publicaci√≥n" /></p>
<ul>
<li>El siguiente paso es descargar y abrir el perfil de publicaci√≥n, si Xcode no est√° abierto, el abrir el perfilde publicaci√≥n lo abrir√°. Una vez hecho esto, podemos configurar nuestra app para usarlos al momento de crear el archivo que vamos a publicar en la App Store.</li>
</ul>
<h2 id="configura-tu-app-para-usar-los-certificados">Configura tu app para usar los certificados</h2>
<p>El siguiente paso es configurar tu aplicaci√≥n de Xamarin.iOS (o tu aplicaci√≥n de iOS normal), la opci√≥n a elegir en Xamarin es &quot;iOS Bundle Signing&quot;, aseg√∫rate de que en la Configuraci√≥n est√© seleccionada la opci√≥n <code>Release</code> y de que como plataforma est√© elegida <code>iPhone</code>. Luego entonces selecciona el certificado y el perfil de aprovisionamiento que acabamos de crear.</p>
<p><img src="https://i.imgur.com/zJGWRBu.png" alt="Configura tu app para usar los certificados" /></p>
<h2 id="colocando-los-certificados-en-github">Colocando los certificados en GitHub</h2>
<blockquote>
<p>üö®‚ö†Ô∏è ¬°Mucho cuidado! ¬°aseg√∫rate de no subir ninguno de los siguientes archivos a menos de que est√©n encriptados! ‚ö†Ô∏èüö®</p>
</blockquote>
<h3 id="exportando-el-certificado">Exportando el certificado</h3>
<p><img src="https://i.imgur.com/G0pF2C0.png" alt="Exportando el certificado" /></p>
<p><img src="https://i.imgur.com/hByhz7g.png" alt="Exportando el certificado" /></p>
<p>Guarda el archivo con el nombre <code>Certificates.p12</code> dentro de la carpeta <code>secrets</code>.</p>
<p><img src="https://i.imgur.com/5gT22K6.png" alt="Guarda el archivo con el nombre Certificates.p12 dentro de la carpeta secrets" /></p>
<h3 id="exportando-los-perfiles-de-publicacion">Exportando los perfiles de publicaci√≥n</h3>
<p>Lo primero es descubrir cu√°l es el perfil de publicaci√≥n que corresponde al que acabamos de descargar, para hacerlo, lista los perfiles con el siguiente comando:</p>
<pre><code class="language-bash">ls -lah ~/Library/MobileDevice/Provisioning\ Profiles/
</code></pre>
<p>En este caso, el m√°s reciente es el que corresponde al perfil de publicaci√≥n de nuestra app, tiene el identificador <code>f3b9e904-6d99-409a-91f4-440c5b79565d</code>:</p>
<p><img src="https://i.imgur.com/9cEkq9v.png" alt="En este caso, el m√°s reciente es el que corresponde al perfil de publicaci√≥n de nuestra app" /></p>
<p>El siguiente paso es copiar el perfil a la carpeta <code>secrets</code>.</p>
<pre><code class="language-bash">cp ~/Library/MobileDevice/Provisioning\ Profiles/f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision secrets
</code></pre>
<p>Toma nota de este identificador porque lo ver√°s en muchos lados, el m√≠o es <code>f3b9e904-6d99-409a-91f4-440c5b79565d</code> pero el tuyo sera diferente.</p>
<h3 id="encriptando-nuestros-secretos">Encriptando nuestros secretos</h3>
<p>Como lo mencion√© al inicio de esta secci√≥n, no podemos subir nuestros secretos (l√©ase el certificado y el perfil de publicaci√≥n) as√≠ como as√≠ a GitHub, antes hay que protegerlos mediante la encriptaci√≥n. Usaremos <em>gpg</em> y la contrase√±a que creaste al inicio de este post.</p>
<pre><code class="language-bash">gpg --symmetric --cipher-algo AES256 Certificates.p12
gpg --symmetric --cipher-algo AES256 f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision
</code></pre>
<p>Despu√©s de esto, deber√°s tener un par de archivos con el mismo nombre que los anteriores, pero con <code>.gpg</code> como extensi√≥n:</p>
<pre><code class="language-bash">Certificates.p12.gpg
f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision.gpg
</code></pre>
<p>Solo para asegurarnos de que no vamos a publicar nuestros secretos al descubierto, los eliminamos:</p>
<pre><code class="language-bash">rm Certificates.p12
rm f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision
</code></pre>
<h3 id="desencriptando-el-certificado-en-github">Desencriptando el certificado en GitHub</h3>
<p>Una vez que nuestros archivos est√°n en GitHub encriptados, debemos hacer posible desencriptarlos dentro de la ejecuci√≥n de nuestro flujo de trabajo:</p>
<ul>
<li>Desencriptar los secretos usando el password almacenado en &quot;DECRYPT_KEY&quot;</li>
</ul>
<pre><code class="language-bash">gpg --quiet --batch --yes --decrypt --passphrase=&quot;$DECRYPT_KEY&quot; --output ./secrets/f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision ./secrets/f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision.gpg
gpg --quiet --batch --yes --decrypt --passphrase=&quot;$DECRYPT_KEY&quot; --output ./secrets/Certificates.p12 ./secrets/Certificates.p12.gpg
</code></pre>
<ul>
<li>Crea la carpeta &quot;Provisioning Profiles&quot; en la computadora que est√° ejecutando las acciones de GitHub</li>
</ul>
<pre><code class="language-bash">mkdir -p ~/Library/MobileDevice/Provisioning\ Profiles
</code></pre>
<ul>
<li>Copia el perfil de publicaci√≥n a la carpeta reci√©n creada</li>
</ul>
<pre><code class="language-bash">cp ./secrets/f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision ~/Library/MobileDevice/Provisioning\ Profiles/f3b9e904-6d99-409a-91f4-440c5b79565d.mobileprovision
</code></pre>
<ul>
<li>Crea un Keychain e importa el archivo Certificates.p12</li>
</ul>
<pre><code class="language-bash">security create-keychain -p &quot;&quot; build.keychain
security import ./secrets/Certificates.p12 -t agg -k ~/Library/Keychains/build.keychain -P &quot;&quot; -A
</code></pre>
<ul>
<li>Establece el Keychain recien creado como default</li>
</ul>
<pre><code class="language-bash">security list-keychains -s ~/Library/Keychains/build.keychain
security default-keychain -s ~/Library/Keychains/build.keychain
security unlock-keychain -p &quot;&quot; ~/Library/Keychains/build.keychain
security set-key-partition-list -S apple-tool:,apple: -s -k &quot;&quot; ~/Library/Keychains/build.keychain
</code></pre>
<p>Todas las instrucciones anteriores debemos colocarlas en un archivo llamado <code>decrypt_secrets.sh</code> dentro de nuestra carpeta <code>secrets</code>, no te olvides de darle permisos de ejecuci√≥n a este archivo mediante el siguiente comando:</p>
<pre><code>chmod +x secrets/decrypt_secrets.sh
</code></pre>
<h2 id="compilando-la-app">Compilando la app</h2>
<p>El siguiente paso en el flujo de trabajo es compilar la aplicaci√≥n de tal modo que nos genere un archivo <code>.ipa</code> que podemos cargar directamente en la App Store, para esta tarea usaremos <code>msbuild</code>:</p>
<pre><code class="language-bash">nuget restore
msbuild \
  /p:Configuration=Release \
  /p:Platform=iPhone \
  /p:BuildIpa=true \
  /target:Build \
  PinCountdown.iOS/PinCountdown.iOS.csproj
</code></pre>
<p>Primero estamos restaurando todos los paquetes de NuGet, luego le indicamos que queremos compilar la aplicaci√≥n usando la configuraci√≥n <code>Release</code>, adem√°s de que queremos que compile el archivo Ipa, y lo apuntamos al proyecto de iOS, que en mi caso est√° en <code>PinCountdown.iOS/PinCountdown.iOS.csproj</code>.</p>
<h2 id="publicando-en-itunes-connect">Publicando en iTunes Connect</h2>
<p>El siguiente paso es publicar nuestro archivo <code>.ipa</code> en la App Store, para ello vamos a usar una herramienta que nos ofrece Xcode:</p>
<pre><code class="language-bash">xcrun altool --upload-app -t ios \
  -f PinCountdown.iOS/bin/iPhone/Release/PinCountdown.iOS.ipa \
  -u &quot;$&quot; -p &quot;$&quot;
</code></pre>
<p>Le estamos indicando a <code>xcrun</code> que nuestro archivo a subir est√° en al carpeta <code>PinCountdown.iOS/bin/iPhone/Release/</code>, adem√°s de indicarle nuestras credenciales mediante secretos de GitHub, de los cuales hablaremos a continuaci√≥n.</p>
<h2 id="configurando-github">Configurando GitHub</h2>
<p>Ahora, es necesario configurar nuestro repositorio con los secretos que vamos a usar para publicar nuestra app, para esto nos dirigimos a <em>Configuraci√≥n &gt; Secretos</em></p>
<p><img src="https://imgur.com/AP4VRrl.png" alt="Ahora, es necesario configurar nuestro repositorio con los secretos que vamos a usar para publicar nuestra app, para esto nos dirigimos a Configuraci√≥n &gt; Secretos" />
Hay que a√±adir tres nuevos secretos:</p>
<ul>
<li><code>DECRYPT_KEY</code>: la contrase√±a que usamos para encriptar los secretos</li>
<li><code>APPLEID_USERNAME</code>: la cuenta de correo electr√≥nico para acceder a iTunes Connect (para mayor seguridad, puedes crear una cuenta de correo espec√≠fica para cada app)</li>
<li><code>APPLEID_PASSWORD</code>: la contrase√±a de la cuenta de iTunes Connect</li>
</ul>
<h1 id="android">Android</h1>
<h2 id="generando-una-keystore">Generando una <code>keystore</code></h2>
<p>Vamos a generar un primer APK de nuestra app porque hay que subir primero na versi√≥n manualmente (gracias Google), y de paso generamos un nuevo <code>keystore</code>.  Ojo que si ya publicaste una versi√≥n de tu app usando otro <code>keystore</code>, ese es el que debes usar en lugar de generar uno nuevo.</p>
<ul>
<li>Da click derecho en tu aplicaci√≥n de Xamarin.Android y selecciona <em>&quot;Archivar para publicaci√≥n&quot;</em></li>
</ul>
<p><img src="https://imgur.com/3egO8Q0.png" alt="Da click derecho en tu aplicaci√≥n de Xamarin.Android y selecciona &quot;Archivar para publicaci√≥n&quot;" /></p>
<ul>
<li>Una vez terminada la compilaci√≥n, da click derecho en el archivo reci√©n creado y selecciona <em>Firmar y distribu√≠r</em></li>
</ul>
<p><img src="https://i.imgur.com/2hk1gX0.png" alt="Una vez terminada la compilaci√≥n, da click derecho en el archivo reci√©n creado y selecciona Firmar y distribu√≠r" /></p>
<ul>
<li>Selecciona el m√©todo de distribuci√≥n <em>Ad Hoc</em></li>
</ul>
<p><img src="https://i.imgur.com/rsVmRGw.png" alt="Selecciona el m√©todo de distribuci√≥n Ad Hoc" /></p>
<ul>
<li>Para crear una nueva <em>keystore</em>, selecciona <em>Crear una nueva llave</em></li>
</ul>
<p><img src="https://i.imgur.com/P7g1BFz.png" alt="Para crear una nueva keystore, selecciona Crear una nueva llave" /></p>
<ul>
<li>En la siguiente ventana, selecciona un alias para tu <em>keystore</em>, establece un alias y una contrase√±a, recuerda esta contrase√±a, vamos a llamarla <code>KEYSTORE_PASS</code></li>
</ul>
<p><img src="https://i.imgur.com/jwfIDZ3.png" alt="En la siguiente ventana, selecciona un alias para tu keystore, establece un alias y una contrase√±a" /></p>
<ul>
<li>Una vez creada, da click derecho para ver mayor informaci√≥n sobre la llave que acabas de crear</li>
</ul>
<p><img src="https://i.imgur.com/9254zZ4.png" alt="Una vez creada, da click derecho para ver mayor informaci√≥n sobre la llave que acabas de crear" /></p>
<ul>
<li>Toma nota de la direcci√≥n de tu <em>keystore</em>, la vamos a usar m√°s adelante</li>
</ul>
<p><img src="https://i.imgur.com/oKRhomm.png" alt="Toma nota de la direcci√≥n de tu keystore, la vamos a usar m√°s adelante" /></p>
<ul>
<li>Por √∫ltimo, continua con la publicaci√≥n natural de tu app y c√°rgala a la Google Play Store, recuerda que es necesario publicar la primera versi√≥n manualmente.</li>
</ul>
<h2 id="cargando-la-keystore-a-github">Cargando la <em>keystore</em> a GitHub</h2>
<p>Al igual que como hicimos con nuestros certificados de iOS, es necesario que carguemos nuestra <em>keystore</em> a GitHub, desde luego, debemos protegerla primero usando <em>gpg</em>.</p>
<p>¬øRecuerdas la direcci√≥n de la <em>keystore</em> que obtuvimos en el paso anterior? es hora de usarla para copiar la <em>keystore</em> en nuestra carpeta <code>secrets</code>:</p>
<pre><code class="language-bash">cp /Users/antonioferegrino/Library/Developer/Xamarin/Keystore/PinCountdown/PinCountdown.keystore ./secrets/PinCountdown.keystore
</code></pre>
<p>Encriptamos, usando nuevamente nuestra contrase√±a <code>DECRYPT_KEY</code> que generamos al incio:</p>
<pre><code class="language-bash">cd secrets
gpg --symmetric --cipher-algo AES256 PinCountdown.keystore
</code></pre>
<p>Por √∫ltimo borramos el archivo <code>PinCountdown.keystore</code>, dejando solamente <code>PinCountdown.keystore.gpg</code> (adem√°s de los otros <code>.gpg</code> correspondientes a iOS):</p>
<pre><code class="language-bash">rm PinCountdown.keystore
</code></pre>
<p>No te olvides de colocar tus cambios en GitHub, para que ahora tu <em>keystore</em> est√© protegida dentro del control de versiones.</p>
<h2 id="desencriptando-la-keystore-en-github">Desencriptando la <em>keystore</em> en GitHub</h2>
<p>Coloca las siguientes l√≠neas dentro del archivo <code>secrets/decrypt_secrets.sh</code> :</p>
<pre><code class="language-bash">gpg --quiet --batch --yes --decrypt --passphrase=&quot;$DECRYPT_KEY&quot; --output ./secrets/PinCountdown.keystore ./secrets/PinCountdown.keystore.gpg
</code></pre>
<h2 id="compilando-la-app-1">Compilando la app</h2>
<pre><code class="language-bash">nuget restore
msbuild \
  /p:Configuration=Release \
  /p:Platform=AnyCPU \
  /target:SignAndroidPackage \
  /p:AndroidSigningKeyAlias=&quot;PinCountdown&quot; \
  /p:AndroidSigningKeyPass='$' \
  /p:AndroidSigningStorePass='$'  \
  /p:AndroidKeyStore=&quot;true&quot; \
  /p:AndroidSigningKeyStore=&quot;./secrets/PinCountdown.keystore&quot; \
  PinCountdown.Android/PinCountdown.Android.csproj
</code></pre>
<p>Con ese comando tan largo de <em>msbuild</em> le estamos indicando que queremos generar un paquete de Android en la configuraci√≥n <code>Release</code>, junto con todos los detalles correspondientes a la <em>keystore</em> que vamos a usar para ese prop√≥sito.</p>
<h2 id="cargando-nuestro-archivo-a-la-google-play-store">Cargando nuestro archivo a la Google Play Store</h2>
<p>Para este paso no es necesario hacer nada <em>&quot;manualmente&quot;</em>, solamente tenemos que usar la acci√≥n <a href="https://github.com/r0adkll/upload-google-play">r0adkll/upload-google-play@v1</a> (que tendr√°s que configurar separadamente). El archivo de nuestro <code>apk</code> firmado est√° siempre dentro de la carpeta <code>bin/Release</code> del proyecto, en el caso de la app que he usado para este proyecto, el archivo est√° en: <code>PinCountdown.Android/bin/Release/com.messier16.pincountdown-Signed.apk</code>.</p>
<h2 id="configurando-github-1">Configurando GitHub</h2>
<p>En este √∫ltimo paso resta agregar un nuevo secreto, en esta ocasi√≥n el secreto <code>KEYSTORE_PASS</code>, que corresponde a la clave que establecimos en un paso anterior. Y listo, eso es todo para la configuraci√≥n.</p>
<h1 id="configurando-github-actions">Configurando GitHub actions</h1>
<p>A continuaci√≥n les muestro el archivo que pone todas las piezas en su lugar, esta es la configuraci√≥n del <em>pipeline</em> de GitHub actions, en teor√≠a, todos los pasos los describimos previamente y aqu√≠ solo resta usarlos.</p>
<pre><code class="language-yaml">name: Build the app
on: push
jobs:
  build:
    runs-on: macOS-latest
    steps:

      - name: Checkout repo
        uses: actions/checkout@v1

      - name: Decrypt Secrets
        run: ./secrets/decrypt_secrets.sh
        env:
          DECRYPT_KEY: $

      - name: iOS Build
        run: |
          nuget restore
          msbuild \
            /p:Configuration=Release \
            /p:Platform=iPhone \
            /p:BuildIpa=true \
            /target:Build \
            PinCountdown.iOS/PinCountdown.iOS.csproj

      - name: Android Build
        run: |
          nuget restore
          msbuild \
            /p:Configuration=Release \
            /p:Platform=AnyCPU \
            /target:SignAndroidPackage \
            /p:AndroidSigningKeyAlias=&quot;PinCountdown&quot; \
            /p:AndroidSigningKeyPass='$' \
            /p:AndroidSigningStorePass='$' \
            /p:AndroidKeyStore=&quot;true&quot; \
            /p:AndroidSigningKeyStore=&quot;$PWD/secrets/PinCountdown.keystore&quot; \
            PinCountdown.Android/PinCountdown.Android.csproj

      - name: Save generated IPA
        uses: actions/upload-artifact@v2
        with:
          name: PinCountdown.iOS.ipa
          path: PinCountdown.iOS/bin/iPhone/Release/PinCountdown.iOS.ipa

      - name: Save generated APK
        uses: actions/upload-artifact@v2
        with:
          name: PinCountdown.Android.apk
          path: PinCountdown.Android/bin/Release/com.messier16.pincountdown-Signed.apk

      - name: Publish to App Store
        run: |
          xcrun altool --upload-app -t ios \
            -f PinCountdown.iOS/bin/iPhone/Release/PinCountdown.iOS.ipa \
            -u &quot;$&quot; -p &quot;$&quot;

      - name: Publish to Play Store
        uses: r0adkll/upload-google-play@v1
        with:
          serviceAccountJsonPlainText: $
          packageName: com.messier16.pincountdown
          releaseFile: PinCountdown.Android/bin/Release/com.messier16.pincountdown-Signed.apk
          track: alpha
</code></pre>
<p>Puedes ver todos los cambios que hice en <a href="https://github.com/messier16/pin-countdown/pull/1/files">esta Pull Request</a>.</p>
<h2 id="errores-comunes-y-consejos">Errores comunes y consejos</h2>
<p>He de aceptarlo, poner todas las piezas juntas me cost√≥ un poco de trabajo, adem√°s de <a href="https://twitter.com/io_exception/status/1282370753279725570">consumir todos mis minutos disponibles en Actions</a> porque estaba probando en un repositorio privado. As√≠ que con el objetivo de hacer el proceso m√°s sencillo para ti te dejo estos consejos:</p>
<ul>
<li><p><strong>Cada que vas a publicar en las tiendas, debes cambiar el n√∫mero de versi√≥n de tu app</strong>: Las tiendas de aplicaciones son muy estrictas en cuanto a las versiones que publicas de tu app, en el sentido de que no puedes publicar la misma versi√≥n dos veces. Te invito a que veas mi post sobre <a href="http://feregrino.dev/versioning-any-app-with-python.html">c√≥mo versionar cualquier app con Python</a> para que veas una manera de hacerlo autom√°ticamente.</p>
</li>
<li><p><strong>Aseg√∫rate de que el <em>pipeline</em>  que publica solamente se ejecute cuando quieres publicar</strong>: si te fijas en el <em>yaml</em> anterior, tenemos configurado GitHub actions para que se ejecute cada vez que alguien hace <em>push</em> al repo, causando que estemos publicando nuestras apps constantemente; el problema es mayor si ignoramos el punto anterior (cada nueva publicaci√≥n en las tiendas requiere una nueva versi√≥n). Una soluci√≥n para este problema es la de solamente ejecutar este <em>pipeline</em> cuando etiquetamos un commit:</p>
</li>
</ul>
<pre><code class="language-yaml">on:
  push:
    tags:
      - '*'
</code></pre>
<ul>
<li><strong>Guarda todas las contrase√±as que uses</strong>: no podr√°s recuperar ninguna contrase√±a de las que guardes como secretos de GitHub, es importante que las mantengas a salvo en otro lado en donde si las puedas recuperar.</li>
</ul>
<h2 id="dudas">¬øDudas?</h2>
<p>Encu√©ntrame en <a href="https://twitter.com/io_exception">https://twitter.com/io_exception</a>, en donde con todo gusto responder√© cualquier duda que tengas.</p>


            </div>
        </div>
        <footer class="site-footer ui">
   <div class="wrapper pure-g">
      <div class="pure-u-1 pure-u-md-8-24">
         <div class="footer-content">
            <ul class="icon-list">
        <li id="em">
            <a href="mailto:feregrino@thatcsharpguy.com" class="contact">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M31 11.815v13.292q0 1.105-.787 1.892-.787.78-1.892.78H3.68q-1.106 0-1.893-.79Q1 26.21 1 25.102v-13.29q.737.82 1.69 1.46 6.06 4.12 8.32 5.78.955.705 1.55 1.1.594.392 1.582.802.987.41 1.84.41h.035q.854 0 1.84-.41.99-.41 1.583-.804.595-.393 1.55-1.096 2.845-2.06 8.336-5.778.954-.652 1.674-1.455zm0-4.922q0 1.322-.82 2.528t-2.043 2.06l-7.835 5.44-.71.51q-.545.4-.905.64t-.87.55q-.51.3-.963.45-.452.15-.837.15h-.034q-.385 0-.837-.15-.452-.15-.962-.45-.51-.302-.87-.544-.36-.243-.905-.637l-.72-.51q-1.525-1.07-4.388-3.055-2.86-1.984-3.43-2.386-1.04-.704-1.96-1.935Q1 8.315 1 7.26q0-1.305.695-2.175.695-.87 1.984-.87h24.64q1.09 0 1.88.786.792.79.792 1.9z"/></svg>
            </a>
        </li>
        <li id="gh">
            <a href="https://github.com/ThatCSharpGuy" class="contact">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M31 16.37q0 4.9-2.86 8.8-2.86 3.93-7.4 5.43-.52.1-.77-.13-.24-.24-.24-.6v-4.1q0-1.9-1.02-2.78 1.2-.2 2.1-.4.9-.3 1.87-.8.95-.5 1.58-1.3.65-.8 1.05-2.1.4-1.27.4-2.93 0-2.38-1.54-4.04.7-1.78-.16-3.98-.57-.2-1.6.2t-1.8.85l-.75.47q-1.83-.5-3.76-.5t-3.76.5l-.8-.54Q11 8.16 9.9 7.7q-1.13-.4-1.7-.23-.86 2.2-.14 3.97-1.54 1.68-1.54 4.05 0 1.6.4 2.9.4 1.23 1.02 2.02.63.8 1.58 1.3.94.53 1.83.77.9.25 2 .37-.77.7-.94 2-.4.2-.82.3-.47.1-1.1.1-.66 0-1.3-.44-.63-.4-1.08-1.2-.38-.63-.95-1-.52-.4-.9-.5l-.4-.03q-.4 0-.57.1-.15.1-.1.24.06.13.18.26t.26.2l.15.1q.44.2.86.73t.63 1l.2.43q.23.75.84 1.2.6.47 1.3.6.7.13 1.34.14.65 0 1.08-.04l.46-.08v2.74q0 .35-.26.6-.25.22-.8.12-4.5-1.5-7.37-5.42-3-3.74-3-8.64 0-4.1 2-7.54 2-3.44 5.45-5.46 3.45-2 7.53-2t7.6 2q3.4 2 5.4 5.46 2 3.44 2 7.53z"/></svg>
            </a>
        </li>
        <li id="yt">
            <a href="https://www.youtube.com/c/thatcsharpguy" class="contact">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M22.43 15.714c0-.413-.17-.714-.504-.904l-8.57-5.357c-.347-.223-.71-.234-1.09-.033-.368.2-.552.513-.552.937V21.07c0 .426.184.738.553.94.178.088.35.133.52.133.222 0 .412-.056.568-.168l8.57-5.357c.336-.19.504-.49.504-.904zm8.57 0c0 1.072-.006 1.91-.017 2.51-.01.604-.058 1.366-.142 2.287-.083.92-.208 1.744-.376 2.47-.178.815-.563 1.5-1.155 2.06-.592.557-1.284.88-2.077.97-2.477.28-6.222.42-11.233.42-5.01 0-8.756-.14-11.233-.42-.793-.09-1.487-.413-2.085-.97-.597-.56-.984-1.245-1.163-2.06-.157-.726-.277-1.55-.36-2.47-.085-.92-.132-1.682-.143-2.285-.01-.602-.017-1.44-.017-2.51 0-1.072.006-1.91.017-2.512.01-.603.058-1.364.142-2.285.083-.92.208-1.744.376-2.47.178-.814.563-1.5 1.155-2.058.592-.56 1.284-.882 2.077-.97C7.244 5.14 10.99 5 16 5c5.01 0 8.756.14 11.233.42.793.088 1.487.41 2.085.97.597.558.984 1.244 1.163 2.06.157.724.277 1.547.36 2.468.085.92.132 1.682.143 2.285.01.603.017 1.44.017 2.51z"/></svg>
            </a>
        </li>
        <li id="tw">
            <a href="https://twitter.com/io_exception" class="contact">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M31 6.7q-1.28 1.88-3.08 3.2.02.26.02.8 0 2.46-.73 4.93-.7 2.46-2.2 4.73-1.46 2.26-3.5 4-2.04 1.75-4.9 2.8-2.88 1.02-6.16 1.02-5.16 0-9.44-2.76.67.08 1.48.08 4.3 0 7.64-2.63-2-.04-3.58-1.23-1.58-1.2-2.17-3.03.63.1 1.16.1.82 0 1.62-.2-2.13-.44-3.53-2.13-1.4-1.68-1.4-3.9v-.1q1.3.74 2.78.8-1.26-.84-2-2.2-.74-1.35-.74-2.93 0-1.67.83-3.1 2.3 2.84 5.6 4.54 3.3 1.7 7.07 1.9-.15-.73-.15-1.4 0-2.57 1.8-4.36 1.8-1.8 4.35-1.8 2.66 0 4.5 1.94 2.07-.4 3.9-1.5-.7 2.2-2.7 3.4 1.76-.2 3.53-.95z"/></svg>
            </a>
        </li>    
        <li id="fb">
            <a href="https://www.facebook.com/thatcsharpguy" class="contact">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.512 1.488c.325.326.488.716.488 1.172v26.68c0 .456-.163.846-.488 1.172-.326.325-.716.488-1.172.488h-7.637V19.38h3.887l.586-4.532h-4.473v-2.89c0-.73.153-1.277.46-1.642.305-.364.9-.546 1.786-.546l2.382-.02V5.707c-.82-.117-1.98-.176-3.477-.176-1.77 0-3.186.522-4.248 1.564-1.06 1.04-1.59 2.513-1.59 4.414v3.34h-3.908v4.53h3.906V31H2.66c-.456 0-.846-.163-1.172-.488C1.163 30.186 1 29.796 1 29.34V2.66c0-.456.163-.846.488-1.172C1.814 1.163 2.204 1 2.66 1h26.68c.456 0 .846.163 1.172.488z"/></svg>
            </a>
        </li>
        <li id="gp">
            <a href="https://www.google.com/+Thatcsharpguy" class="contact">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.9 14.25h-2.7v-2.72h-2.73v2.72h-2.7v2.72h2.7v2.7h2.72v-2.7h2.7v-2.72M10.5 17.5h5.4c-.22 1.4-1.64 4.12-5.4 4.12-3.25 0-5.9-2.7-5.9-6 0-3.33 2.65-6.02 5.9-6.02 1.85 0 3.08.78 3.8 1.46l2.58-2.48c-1.66-1.55-3.8-2.5-6.38-2.5C5.26 6.1 1 10.35 1 15.62s4.26 9.52 9.52 9.52c5.5 0 9.14-3.86 9.14-9.3 0-.62-.07-1.1-.15-1.57h-8.96"/></svg>
            </a>
        </li>
    </ul>
    <ul class="icon-list">
        <li>
            <a href="#">
                <svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M7 18.89v-5.88H1.15v-6H7V1.1h6v5.91h6V1.1h6v5.91h5.85v6H25v5.88h5.85v6H25v5.912h-6v-5.91h-6v5.91H7v-5.91H1.15v-6H7zm6 0v-5.88h6v5.88h-6z" fill="#3C8A3F" fill-rule="evenodd"/></svg>
            </a>
        </li>
    </ul>
         </div>
      </div>
      <div class="pure-u-1 pure-u-md-6-24">
      </div>
      <div class="pure-u-1 pure-u-md-10-24">
         <div class="footer-content">
         </div>
      </div>
   </div>
</footer>
</body>
</html>
